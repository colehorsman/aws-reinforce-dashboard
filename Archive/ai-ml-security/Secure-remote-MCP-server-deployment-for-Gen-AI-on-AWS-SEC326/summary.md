# AWS re:Inforce 2025 - Secure remote MCP server deployment for Gen AI on AWS (SEC326)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=lC2dLQZAlo8)

## Video Information
- **Author:** AWS Events
- **Duration:** 18.4 minutes
- **Word Count:** 3,337 words
- **Publish Date:** 20250619

## Summary
This AWS re:Inforce 2025 session, presented by James Ferguson (Principal Security SA) and Aaron Brown (AI Solution Architect), focuses on securing Model Context Protocol (MCP) server deployments for generative AI applications on AWS. The session addresses the evolution of MCP from its launch by Anthropic in November 2024 to its widespread adoption by major tech companies, including OpenAI, Google, and AWS.

The presenters identify several critical security gaps in the current MCP protocol implementation, including inconsistent authentication methods, lack of role separation, absence of tool verification, and limited observability for governance. These vulnerabilities create multiple attack surfaces, ranging from authentication bypass to prompt injections and tool poisoning, which pose significant risks in enterprise environments.

The session introduces an open-source solution called MCP Gateway, developed by AWS, which provides a centralized approach to MCP security and control. This solution includes a unified gateway with built-in authentication, logging capabilities, and a registry system that supports both user session cookies and machine-to-machine (M2M) authentication flows, effectively addressing the security challenges while maintaining scalability and ease of implementation.

## Key Points
- MCP has become the universal protocol for AI agent-tool integration since its launch in November 2024
- Current MCP implementations suffer from multiple security vulnerabilities and design flaws
- The solution introduces a centralized MCP Gateway and Registry system for enhanced security
- Authentication can be handled through both user session cookies and M2M flows
- The system supports fine-grained access controls at server, method, and tool levels
- Implementation includes a dedicated authentication server that validates credentials from various IDPs
- The solution separates authentication components from MCP servers for better security
- Tool discovery and intelligent tool finding capabilities are built into the system
- The entire solution is available as open-source through the AWS Agentic Community
- Regular biweekly community meetings are held to discuss and improve the solution

## Technical Details
- Gateway implements NGINX reverse proxy for request interception
- Authentication server supports multiple IDPs including Cognito and OCTA
- Supports JWT and session Cookie-based authentication methods
- MCP servers can run in containers, ECS, or Lambda
- Registry provides both web UI and MCP server for dynamic tool discovery
- Three-level scope composition: server access, method access, and tool-level access
- Transport layer supports streamable HTTP and SSE
- Implementation includes proof of key exchange on app client
- Intelligent Tool Finder feature performs semantic search for available tools
- Solution can be deployed locally or in remote environments using Fargate/EC2

## Full Transcript

Welcome to Reinforce 2025. Uh, I'm James Ferguson, a principal Security SA. I joined with Aaron Brown. Erin, hey everyone, Aaron Brown, uh, AI solution architect here at AWS, and today we're gonna be talking about model con context protocol security. Our agenda today is we're gonna go through introductions which we just did. We're gonna talk about the context, the problem solution, and then finally a reference demo and a way forward. Again, uh, James Ferguson and Erin, good to meet you guys. Uh, MCP has emerged as the universal protocol for AI agenttic tool integration. Protocol launched by Anthropic in November 2024 is now adopted by OpenAI, um, Google, uh, AWS, many, many others. You wanna take, yeah, I, I, I think with the MCP the real aha moment has been that we're able to now give agents or really these models now tools they can invoke for external systems for context this is released back in around the November time frame, mostly for local desktop usage for the, the product cloud desktop. It's since evolved as everyone's seen the utility as an abstraction layer for enabling tool use to now in remote environments, so that's really the context and understanding of where it started just a few in the past 12 months to where we are now moving to today. Awesome. So, uh, a couple gaps that have, uh, kind of emerged on the MCP protocol side, uh, especially around security vulnerabilities. I'm sure many of you are aware of those. Uh, every server implements OAS, uh, and forces developers to build, um, you know, authentication repeatedly with inconsistent, uh, security styles and, and methods. Uh, there's no role separation at all between, uh, the OAS, uh, server and authorization and the resource server itself, which is part of MCP. There's zero tool verification in other words, there's no way to verify tools themselves, at least currently. Um, there's all or nothing access. In other words, granting one tool permission, uh, exposes the entire service capabilities across MCP. Uh, there's no observability layer. In other words, the ability to do governance, uh, audits, etc. and then there's missing approval work flows. In other words, AI agents execute critical actions without human oversight actions at all. A couple other things around design flaws create multiple attack services, um, you know, being a security expert, uh for years, um, these are very common. Uh we've seen this since the, you know, first, uh, step of the Internet, right? Uh, 80s, 90s to today, authentication and authorization and personalization. Uh, you know, OA flows, privilege abuse, um, tool interaction risks, you know, uh, whether you're running SOA, uh, APIs, uh, etc. going back to 3 stack architectures and Gen AI today, same thing, uh, you have prompt injections, you have tool poisoning, uh, you have command injection, you have infrastructure weaknesses, right? Uh, in other words, um, DOS attacks, supply chain compromises, authentication bypass, um, those are all kind of real attack surface issues with MCP. And then also indirect manipulation, in other words, host compromise leading to unsafe tool invocation. So today we're gonna talk about uh a way forward. Uh, Aaron is one of the builders here at AWS so uh it's an honor to be here with him. Um he and, and many of us have been working on the MCP kind of security architecture to help centralize infrastructure security and control. So, uh, he's come up with a thing called MCP Gateway, and we're gonna have him talk a little bit more about that, Erin. Yeah, I think before, so we're gonna show a reference open source solution that um some folks at AWS like Aurora and others have been have been leading on, but there's one key takeaway before we talk about the actual reference solution. It's that the trend we're seeing now of MCP in terms of security, it's how can we centralize effectively through a gateway and a registry, similar to what we saw for the past 1 to 2 years with LLM and gateways and also other services as well, um, so, so and with that now in the next slide. The reference implementation here and this will all have QR codes, well we're we're gonna dive through the next 5 minutes in this is an open source implementation of an MCP gateway and registry that's this current code repo what we're gonna go through is host on the um AWS Agentic Community, which is an AWS open source um get get repo. And what the solution is, is a unified MCP gateway that's through a scalable uh E X entry point that accesses as a central gateway for self-hosted MCP remote MCP servers, whether that be in Fargate EC2, etc. This gateway service is centralized. It also enables logging and we also have authentication built in and we're gonna dive into really more what that means in the next slide. Um, awesome. So really, you know, the challenge of MCP is it requires traditionally in the current state, uh, each server to handle off on its own. That's not really unmanageable enterprise scale. So again, in this solution is a centralized gateway and register that handles all authentication. The main component here that you see in green is is the gateway. That's the Engine X reverse proxy that intercepts every request. The other really important part here is that the off server that we can see. In the bottom part of the, the green box there, and that off server is a dedicated service that validates credentials from whatever IDP we have in the configuration we have today, we have Cognito, we also have this service which is open source that connect to other IDPs whether that be OCTA, etc. We also have a registry, and this registry provides both a web UI, uh, for humans and an MCP server for dynamic tool discovery itself. We'll talk a little bit more what that means in a in a quick demo. MCP servers themselves remain stateless with zero code for off, and the identity providers again we allow the ability to configure any IDP and we're gonna go through two different authentication mechanisms whether they be user session cookie or M2M. Um, and really when we talk about how an agent wants to call a tool, and we're gonna go to an example, the way that first works as an agent will connect to that central entry point, uh, whether that be through the transport layer of streamable HDP or SSE. Engine X receives that requests with the off headers JWT or session Cookie. And then E uh Engine X makes an internal call to the off server to validate those credentials. The off server checks if Cognito returns the allowed scopes based on those fine grained access controls, and then EX adds those scopes as the reverse proxies to the appropriate MCP server. And then MCP server then runs locally in a container or remote or um or remotely in EKAS or lambda. The tool that executes over that persistent connection over that transport layer and the response is then streamed back to the agent and really what this means is we're separating effectively the off component from the MCP server itself so the agent and the MCP server and that off mechanism are disconnected but still happening. And just to be clear, the, uh, slide you see now might seem a little smaller busy, uh, you know, for, for the audience. So, uh, the GitHub repo we're gonna share with you at the end of this, uh, has that information on it as well so just so you know. Yeah, this is a lot to look at. This is the uh off flow. We're gonna again all of this is open source. We have links we can talk after. I'm gonna talk through this, the two off paths with either either using M2M or uh user session, uh, cookies with M2M. This is where the agent has its own identity, um, so for monitoring for the workflow and agent then accepts the credentials from Cognito with JW2 with those embedded scopes directly in. Um, and then with the session cookies, user groups like MCP admin are mapped to the same scopes using a scopes file that we actually have configured in the solution, and these scopes are composed at three different levels. We have a server access. This is for can the agent access the server? Method access can you call a tool or just list them? And then tool level access. So within a specific server within a method can you access that specific tool because servers can have different, different tools as well. Um, and now we're gonna go through two quick examples of what this solution looks like. We're first gonna start off with the agent user identity mode. So in that previous offload we're gonna zoom in now to using those session cookies, um, where an agent is able to act on behalf of a user using their Cognito identity in this in this demo and groups memberships for authorization. Now what this enables is for your proof of key exchange to be enabled on the app client itself. And we're gonna showcase through um a hosted UI how you can do that appropriate call back to the URL, how we can then pull back that session cookie and actually persist and then actually make the reference agent call. So when we play this demo what you're looking at here is the admin login page of the MCP gateway dashboard. This is just basic off right now. This could be for uh configured for actual SSO. But for right now what you're looking at is a dashboard of the available MCP servers, toggles which effectively tools are within within each MCP server itself you can turn them on or off. You can modify them. You can think about this as a central gateway for maybe developers who want to know what specific MCP servers they have access to. Um, Or as administrators to manage that access you're seeing myself here launch for that user session of a simple tool to enable the agent or to enable me to do a call back to log into Cognito. You're seeing me pass in credentials of my username and password. I get an authentication accept request then I have now that session cookie then on my on my device itself. And now I can go and actually ask a question. You just saw me this kind of happened a little fast, but in the question above I asked a simple lane graph agent. I pointed it directly to the HDP, the local, the uh the MCP gateway itself. I asked a specific question of what time is it in Ion, China. And right now this agent itself, another component we have in here is the ability to find other tools within the registry itself that it has access to so this agent doesn't, for instance, have access directly to the time server that we have in here, but it does have access to a tool called Intelligent Tooliner that you'll see. On the line above there that I'll highlight soon and then with that intelligent tool finder effectively does semantic search to say what other tools do I have that I do have access to based on my specific scopes that I can now actually perform this task. Now you can see what we're scrolling through and we'll scroll down the agent actually went through it asked what time it is. It identified it used the intelligent tool finder because it did not have the actual, uh, a tool to access it but had access to this one tool to search for tools. It had also access to perform that and it retrieved that back and was able to actually identify the current time server and then actually come back with the specific time for when I ran this again what we're showing here is using that user. Um, user session cookie with me upstream identifying. Uh, and logging in getting a session cookie that being authenticated from, um, our service, it being returned the scopes that are it's allowed to perform and all of that off happening in the MCP gateway register service itself. On the next slide Um, we're gonna show if we go one slide more, we're now gonna talk about a very same exact demo in terms of a question but now using a different authentication scheme we're using M2M or machine to machine. That's where effectively again we're using token requests tokens using in our client credentials we're using a JWT, um. Token itself that's embedded within the scopes and we do that token validation through the off server itself where the JWT signature and claims are validated and that scope enforcement is accessed based on those token scopes itself. Again, I think the key takeaway is this M2M flow typically if you remove the word MCP it's not too different than what we're all typically used to. Um, the flow generally remains the same. It's just now we're giving it to a a specific machine identity now and the next slide. We're now just gonna do the same exact demo, but you're gonna see I've already loaded some environmental variables for this demo here you can see in the top we passed our client ID, our client secret, our user pool, and I asked the same exact question. We can see how now we're using the authentication mechanism of M2M with specific tokens from our Cognito ID our user pool. We can see we found the credentials for um itself and then it was able to identify the. That same exact agent, the list of tools that had available based on a specific identity. Um, and when it was authorized to perform, it was able to hit the gateway and do that authentication, able to find out what it's authorized to perform. And this will go through the same level access where we can see it has access to an intelligent tool finder. It does not have access to something called current time server, which is the time server to retrieve time, but then it does that semantic search to actually search and identify which other tools does it have access to and pulls those back, finds the time server, and ultimately will get the time. Uh, for this as well. So Um, So these are just two examples to summarize to showcase how you can do user session cookie and M2M off through a centralized MCP gateway and registry to both perform authentication and authorization along with establishing identities and then also showing some of the infrastructure components of how you can think about dealing with a registry for doing things services like intelligent tool finding, etc. all of with having some of having find and access controls. Perfect thanks. Yeah, so, um, a couple of things that we're, we're doing here at AWS we have uh uh open source community we've launched, uh, recently, um, and so if you guys are interested in joining, uh, that community, we're more than, uh, happy to have you join us. Uh, we have, uh, biweekly meetings. uh, I lead the, uh, STO or single threaded owner for security along with others, uh, like Erin who lead the builder experience side. And so, uh, we'd love to have you join us, uh, be part of that if you don't have the time, completely understand, but that Agenta community is open source on GitHub, and we're gonna give you some, uh, QR codes here in a moment. You can go to that. You can download the solution that Aaron just gave you, by the way, he ran that on his, uh, airline while he was, uh, flying. So, uh, just to show you the speed and the ability of that that solution to work regardless of where you're at is, is kind of amazing. So again, um, you know, 0 2.1 spec improvements with dynamic identities. A lot of us have seen write ups about that CISA and and many others, uh, are talking about token exchange, uh, which is the OA 2.1 spec. The need for agents to be able to make decisions and then get different scopes of identities as they're making those decisions definitely needed, and that's kind of the new path forward. So again, OA 2.1 spec. And then also dynamic identities themselves are are definitely needed. So part of what the solution went through with the MDM, uh, with Cognito, um, gives that solution, uh, side, uh, idea to you as a, as a customer or as a user of ADOS services, but you can also use open source, uh, you know, identities as well. It's completely up to you on which you want to use, um, MCP registry development enables centralized server discovery with metadata validation. Uh, agent graphs and interactive work flows require enhanced permission scoping and behavioral monitoring, just some takeaways, uh, from today. Industry convergence on secure by design principles for AI agent deployments is still very nascent but still being worked on. You're seeing that across the industry. A lot of people involved in that as well. I, I think if it's one thing, maybe just add on to that is I think the general trends James mentioned is a movement towards registries, um, similar to what we've seen now with LM gateways. And that while we do have a reference solution here which you, you can all I recommend taking a look at fork it look at our road map, feel free to contribute um there's also still some really interesting questions that we're all still thinking through in terms of for instance different scope levels for tool level access a shell tool is very different than, um, a current time tool. How do you deal with managing scopes at a tool level is an interesting concept as well I guess needless to say, this this field is rapidly evolving, so. You know, while it is evolving, we do think these constructs like gateways and registries are gonna be what we're gonna see probably even 12 to 18 months from now some of what we see now with LM gateways. Yeah, so a couple, a couple links we, we provide for you, the MCP specification from Anthropic directly, uh, that launched last November as we already suggested, uh, OF 2.1 spec, um, and then also the MCP gateway and registry that, uh, we just demoed, uh, is on this page. Uh, I'll give you a moment to take a picture of that if you'd like, uh, and then we also have some other additional, um, you know, kind of tools for you. So MCP security tools, um. There's a, there's a stitch MCP scanning tool, uh, very well done open source. There's invariant labs MP MCP scanner. It goes through all of the tools, for example, scans, does really thread analysis, etc. By the way, you can also build that with Agenic systems in addition, so it's great to see, you know, kind of the use cases out there in the wild. And then lastly, the Agenta AI threats and mitigations from the OAS community and the top 10. I definitely recommend you review that. Uh, in my opinion, that's more, uh, you know, kind of detailed than the original OAS top 10 for GAI itself. So, um, again, um, all tools that, uh, we definitely recommend you guys take a look at. Anything else? Yeah, I think that's, I think that's about all we have. We're, we're here to take questions on the side once, once the session's over, and again, thanks again for joining. Yeah, thank you all, appreciate it.
