# AWS re:Inforce 2025 - Scaling AWS threat intelligence to protect customers (TDR304)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=LJ64I_ZT-Gg)

## Video Information
- **Author:** AWS Events
- **Duration:** 52.0 minutes
- **Word Count:** 8,848 words
- **Publish Date:** 20250620
- **Video ID:** LJ64I_ZT-Gg

## Summary
This session from AWS re:Inforce 2025, presented by Mike, Paul, and David, focuses on AWS's threat intelligence capabilities and how they protect customers from cyber threats. The presentation reveals that within 90 seconds of connecting a host to the internet, it typically experiences its first exploit attempt, highlighting the critical need for robust security measures.

The speakers discuss AWS's approach to active defense, which involves processing massive amounts of security telemetry data (8.2 billion flows per second) and tracking approximately 50,000 potentially malicious IPs in real-time. They detail how AWS built a custom stream processing solution using Rust to handle this scale efficiently, as existing solutions like Flink and Spark weren't cost-effective for their specific needs.

The presentation explains how AWS's active defense capabilities provide transparent protection to all customers, resulting in a 75-80% decrease in malicious interactions compared to unprotected internet exposure. The system integrates with honeypots for threat intelligence gathering, processes various data sources including VPC flow logs and CloudTrail, and implements protections that benefit all AWS customers without impacting legitimate traffic.

## Key Points
- Hosts typically experience first exploit attempt within 90 seconds of internet connection
- AWS active defense reduces malicious interactions by 75-80% compared to unprotected exposure
- System processes 8.2 billion flows per second and tracks 50,000 potentially malicious IPs
- 12.5% churn rate in malicious IP list occurs within 3 minutes
- Custom solution built in Rust due to existing solutions not meeting scale requirements
- Micro-batch processing approach chosen over traditional streaming for cost efficiency
- Protection measures must be safe to apply across all AWS customers without impacting legitimate traffic
- System integrates threat intelligence from multiple sources including honeypots
- Protection is provided automatically and transparently at no additional cost
- Uses OCSF (Open Cybersecurity Framework) for data normalization

## Technical Details
- Built using Rust programming language for efficiency and safety
- Implements Aho-Corasick algorithm for efficient string matching across multiple rules
- Uses S3 for data storage with event notifications for new objects
- Processes micro-batches of 10,000-100,000 events instead of individual records
- Leverages ECS and AWS Fargate for container management
- Implements JMESPath for complex rule matching logic
- Uses pre-filters to optimize matching against large sets of threat indicators
- Integrates with AWS services: S3, SQS, Kinesis Streams
- Performs inline enrichment including ASN and geolocation data
- Supports analysis through AWS Athena and Spark for offline processing

## Full Transcript

Welcome to TDR 304 scaling Amazon threat intelligence to protect customers. My name's Mike and I'm joined by Paul and David who will be presenting as well today. 90 seconds when you connect a host to the internet, it's about 90 seconds before it experiences its first exploit attempt, and we'll what we're doing is peeling back the curtain on some of the internal things that we're doing within AWS to actually make that longer and make AWS safer for all of our customers. And we'll do that where I'll start by going through some data driven defense that we're doing really focus on more of a builder session for how we're doing high speed data processing to detect threat intelligence. Then I'll hand it off to Paul who will talk about using our deception technologies to track emerging threats, and then David will bring us home and on how you can utilize those same uh the same intelligence that we provide through the AWS security services to improve your own security posture. And so we'll go through, we'll start with some honeypot information and how we collect threat intelligence from honeypots from AWS telemetry from our open source intelligence and how we analyze, research and detect threats from that and then how we feed that and perform Internet-wide disruptions such as botnet takedowns, how we use our active defense capabilities to provide AWS wide protections and how we feed all of that into the AWS security services so that you can leverage them yourselves. And I'll start, like I said with a little bit more of a builder session because we'll be deep diving into an architecture that we built to do some high speed data processing for exactly this. Now this wouldn't be a good security talk without the shared security model that I'm sure you're all tired of seeing where AWS is responsible for security of the cloud and you are responsible for securing your own workloads within the cloud. But if you didn't realize this, AWS builds on top of AWS so it's really AWS all the way down and what we realized is that by securing our own workloads and securing the cloud we could extend some of those same protections to all of our customers and protect everyone to make AWS a safer place for everyone and that's really where this idea of active defense was born. Active defense is technically a detective and corrective security control, but I like to think of it as making bad things stop happening for all of our customers automatically, transparently, and at no additional cost really to make AWS a safer place to operate on. And this is an example of what that looks like. This is a tale of two honey pots, and as you know, for a honey pot, there are no, there is no legitimate reason to interact with the honey pot. Every interaction with the honey pot is going to be a vulnerability probe, a port scan, an exploit attempt. So each of these interactions is malicious. Now the upper line there is that honey pot operating logically outside of AWS as if you directly connected it to the internet, completely unprotected. And the much smaller blue line down there is the interaction seen on the same honey pot operating inside of AWS and protected transparently by our active defense protections, and this results in about a 75% to 80% decrease in malicious interactions that you would see just by operating on AWS. Now, not only is this directly beneficial because it eliminates that potential malicious traffic, but it also makes your security more effective because then we eliminate that traffic that you don't have to deal with as part of your own security program. And it saves a little bit of cost in compute and networking as well, which is always a benefit. And how do we do this? We do this through a detection and response workflow where we process AWS security telemetry, the same security telemetry that you know and love, VPC flow logs, Route 53, query results, cloud trail. We use a couple of core data processing components to analyze and detect threats within that, and then we ultimately mitigate that across all of AWS by preventing that traffic. One big difference with active defense, however, is that. What we do, we apply to all of AWS, which means it needs to be safe to apply for every customer. For example, one of our capabilities is blocking IP addresses at the border of AWS to prevent any traffic from that IP address from entering AWS. So we need to be sure that that will not impact any legitimate customer traffic at all, and we will not impact your workloads. That is a core tenant of ours. So this is really different from what you can do with with securing your own workloads where you know much have much more detail about what is actually going on in your own workloads and can tailor your response to those workloads. Our response is tailored to all of AWS and improving the security across AWS in general. And how does this integrate with threat intelligence? Well, first of all, we consume threat intelligence and Paul will tell you a lot about more about how we generate some of that with our honey pots. We consume that and use it as part of our threat detection capabilities and we also publish the results of our detections back to that collective intelligence which ultimately flows downstream to the AWS security services which David will talk more about later. And for the rest of my section here, I wanted to talk more about sort of these particular components, specifically that data processing aspect and how we're actually doing that at scale. And I wanted to drive it with one simple question, which is pretty much if you look at the pyramid of pain for threat detection it's all the way at the bottom is how do we match threat intelligence against the data in our telemetry and prevent it from happening or more simply how do we detect when AWS is interacting with known bad IP addresses. Now we do more complicated things than this, but this helps us illustrate the scale of things that we're operating at because it's actually pretty simple. And that scale comes in two different Problems. The first is the telemetry itself. We're looking at Amazon VPC flow or the equivalent of Amazon VPC flow. These are internal systems, by the way. And so our equivalent of VPC flow, we're looking at about 8.2 billion flows per second. If you like analogies, this is like checking the idea of every human on Earth, every second. If we take 1 millisecond to process those incoming records, we would require 8 million CPUs, which is really not cost effective for us to do at scale. So that's our incoming data. We also process other data sets like Cloud Trail and Route 53, as I mentioned, but we'll focus on flow for the moment. And then on the other side, we have the incidents of threat indicators that we're tracking, and we're tracking about 50,000 possibly malicious IPs at any given time. And if you dealt with threat intelligence, you know that it's only good fresh, especially in the IP range where people can cycle IPs so quickly that it can go from malicious to non- malicious on the order of minutes we see about a 12.5% churn on this IP list within about 3 minutes, so we need to keep up with that. We don't have the luxury of batch processing things, storing all the data, doing daily reports. So what we really need and rounding up a little bit, what we really want is something that can evaluate 100,000 rules against about 10 billion incoming events per second to detect those threats. And like I said, we don't have the luxury of storing it and doing it in batch, so we need that to be a real-time streaming system. So this led us to investigate a number of stream processing capabilities like Flink, like, uh, spark structured streaming. The problem is that these did not scale to the level that we needed effectively or cost efficiently, mostly because they were doing a lot more than what we needed. We need some, we needed a very simple stream filtering and selection engine. So we made the hard choice to build it ourselves, and I wanna walk you through what that looks like. First of all, we were designing for two things efficiency and operational simplicity. For efficiency, we decided to write it in rust because it's an efficient and safe language and is the new hotness and is very well supported by AWS. There's official clients, so we were able to effectively build on top of AWS. We needed to limit all of our serialized interfaces, so we couldn't break this up into lots of microservices, make external API calls. We have less than a millisecond to process each record. Uh, and anytime you make an external API call, you're in the multiple millisecond range, and we knew we wanted it to be multi-tenants so that we could actually support a large number of rule sets from across Amazon and be able to match and optimize them all together. And then for operational simplicity we went with containers on ECS and AWSargate and then another key feature that we did was micro batch processing, which is a little bit different than traditional stream processing, but I'll get more into that next. So this is the architecture that we came up with, and I show that for two reasons. One, it's pretty simple. It uses very standard AWS processing where we store data in S3. We use S3 event notifications to notify of new objects, new micro batches of records of events. We process from SQSQs and then we ultimately deliver to kinesis streams so that we can do follow on analytics and actually utilize some of those more efficient more uh large scale streaming features like kinesis streaming analytics. Now on the micro batch approach which I mentioned generally when you're talking about a stream processing system you're looking at technologies like uh CAFA or Kinesis to do record by record streaming where you're sending individual records across the stream we found that those even didn't scale to the level that we needed or at least scale cost effectively for us and it was much more cost effective for us to bundle these. Uh, events into records into S3 objects containing about 10,000 to 100,000 events and then actually process those as a unit through the system. So this allows us to use S3 as our data plan for processing this data and it was dramatically more cost effective than the other streaming technologies and it comes with some side benefits. One, it's fairly simple to to reason about. 2, it reduces the complexity of our overall system. We get arbitrary retention with S3 so we can store the objects as long as we want in there, and we can analyze them offline with tools like uh AWS Athena or Spark where we can actually process those directly from S3, whereas if you tried to process things from Kafka or Kinesis, you know that generally use specialized clients and specialized tooling where there's much more tooling available for processing from S3. But that really just pushed the problem down into that into that process bucket where we're where we're actually doing the meat of the work of actually matching that threat intelligence against uh the data that the incoming data and so what that looks like within that rust binary is we're reading an object into memory we're converting it from whatever native format it is into JSON we're extracting and normalizing it into OCSF, the open cybersecurity framework, which also powers the Amazon security lake. And then we do whatever inline enrichment we have, which is for example we add ASNs to IP addresses, geolocation, but again we have to do this in line and we have no ability to make API calls so we do whatever we can and then we ultimately match that against all the loaded rules that we want to evaluate for threat detection. And then ultimately output the results of that to S3. Now, when we talk about the rules, we need to understand what the rules actually look like. Now we started out with a very simple concept of hey I wanna match IP addresses, but we knew we wanted to do more than that and we wanted to have a full featured threat detection engine. And so our rules we know we we knew we needed a full featured language in order to express boolean functions in order to uh annotate any part of the JSON object that we wanted to and so we chose JMS path, which is a JSON query language, as our as the basis for our rule and so you can see here we're looking for two source IPs, uh, either one, which they connect to not on port 443. So a very simple rule but still illustrates, uh, the idea of a threat detection rule. The problem with this is that we can make this very efficient to match singly. However, we have 100,000 of these that we want to match against the income within a millisecond against the incoming data. And so what we really needed is a way to match all of them at once and we didn't have a way to do that with most of the languages like JMSPath like SQL is to operate across multiple at once. So what we decided to do was break this into two parts where we took those IPs which. Which was the strings that were required to be in the underlying data and we put them into what we call a pre-filter. And then we kept the JMS path rule for any more complex logic that we wanted to apply and in this case we were actually able to remove those IP addresses that threat intelligence ultimately into this prefilter. And keep the more complex logic and so this seems to just move around the problem of matching everything but we have a secret and that secret is how we actually do this matching across all of these pre-filters because what we've done here is we have incoming JSON and these prefilters are strings we also support red X's. But what we can do is figure out a way to match all of those pre-filters at once and only determine the necessary rules that we need to actually follow on and do the more complicated, more expensive logic on them. So this translates the problem of optimizing all that GMES path into optimizing string search across multiple. Rules. And so our secret is not much of a secret because it's an algorithm from the golden age of computer science, the 1970s called Ahoarasic, which happens to be one of my favorite algorithms and I highly suggest you checking it out. But what it does is it takes all of those strings and builds a prefix tree. And I don't have time to dig too far into it, but It builds that prefix tree and allows us to match all of those strings at once with a single pass of the incoming data. And this is really the secret to how we can scale to such levels. And like I said, I highly suggest you checking it out. It's a very short paper and it's very accessible and if you haven't dealt with prefix trees before and how they can be applied to this, this problem, definitely recommend it. We've also been able to apply this because this algorithm usually exists in libraries in multiple languages. We've been able to apply this in multiple places such as within our spark batch processing jobs where we're trying to match a large number of things against a lot of data to dramatically speed that up as well. So finally what we realized was that what we were creating was really a streaming first architecture and as a consequence of storing that data, that preprocessed data in S3 where we've enriched and normalized it. We could then do more latency insensitive operations to it such as batch processing we can transform that to parquet to enable active investigations, active human investigations, and we can do batch processing to build summaries and indexes to make it easy for us to go back to that data and find support our investigations and our, our more complex threat detections that require longer windows of data than are supported by our streaming system. So this really led us to this streaming first architecture that we have now that still enables that low latency stream processing and filtering aspect for our threat detection and response, but also enables the higher latency investigations and batch processing. And all of this was done ultimately to better protect AWS, feed these threat detections downstream, and take active mitigations against them. And so now I'll hand it off to Paul who will talk about our deception technologies. Thanks Mike. Mike mentioned a bit about how honeypots are a key source of threat data for uh what what his team does, which is protect all of Amazon and help make AWS a safer place. I would like to start my section by giving you a dad joke. Now, if this is the seed of my section, I'd like to refer to the collective output of my team as dog food. We make firewall healthier, right? We feed the right threat intelligence to power protection mechanisms that protect our infrastructure and mechanisms that are the foundation of our security, external security services. So, today I'm gonna walk through how we do this, placing a lot of emphasis on how we automatically generate thread intel because that is the key for staying on top of emerging threats. To do this, I'm first gonna lay the groundwork on and talk about some of the challenges we have to be mindful of. Everyday threat actors are evolving their arsenal. And that's because the security community, which I assume is most of us here and, and the three of us here on the stage, are working so hard to mitigate what they're doing, but we're trying to prevent them and disrupt them uh from continuously doing their malicious activities. And so because of that, they are forced to evolve. They are forced to innovate and that presents a challenge for us, right? It's this endless cycle. We need to be Uh, we need to know how to answer this question. How do we track tactics that are constantly changing? Challenge #2 exists because of the ever-growing database of software vulnerabilities. In 2024, there were roughly 100 CVEs registered every day. That means that while you've been at this conference for 3 days, there are 300 vulnerabilities new waiting for you on your desk when you get to get to work tomorrow. On top of that, 230 of those vulnerability vulnerabilities last year were, had a higher security uh severity score, sorry, of 10, uh, which is scary. So This challenge is for us. Uh, the challenge for us is to know how do we effectively prioritize our investments in security? Where do we research? What do we look at? How, what do we care about most? Cause it's obviously a, a game of trade-offs. And the last challenge It's perhaps more specific to my team. We're tasked with producing intelligence that's gonna protect all of AWS. And I'm sure when you're designing your security controls for your workloads, you're trying, you're working hard to understand what good traffic looks like. You look at all the traffic, you understand what good is, and while you're doing that, you're looking for the things that are bad and you can use that information to respond. I can't look at all of your traffic, and for good reason. I have limited visibility, so how do I get visibility into the threats that are going on? And um I need to sorry, further than this, I've got to be able to know what threats are specific to AWS, right? You know, the workloads running on AWS are attracting a certain type of threat activity. What does that look like? So to solve these three challenges, I'm gonna talk through a story now that illustrates how we use an automated flywheel to do this. Introducing raperbot. This story begins early this year, uh, where my team was tracking a really active DDoS botnet. The botnet, which we refer to as rapabot, uh, the reason we do that is because the malware resembled very, uh, uh, it resembled a malware that was released a couple of years ago called rapabo. And we think it's a, a version of that. As I said, very active DDoS botnet. We saw uh attacks um reaching some of these numbers here close to a billion packets per second. That is huge. Um, and we saw, you know, a lot of bandwidth being pushed even up to, you know, 3 terabytes per second. So, Our DDoS AW Shield, DDoS mitigation Services recorded these values and um we got involved in this because This is a really, uh really big scale uh volume. So I picked this example, not only because of the scale, but also because I wanted to show how this botnet is evolving, right? This was, this botnet was evolving as we were researching it and that's uh if we didn't have our automated workflows producing thread intel, we would have had to spend a large amount of manual security engineering hours, which, uh, of course, no one just has lying around. So how does this start? This starts by a botnet being built. Some thread actor finds a vulnerability and starts exploiting that to compromise it and install malware on. Over time, these botnets grow and grow. They could be uh silently growing for days, weeks, months, uh, perhaps even years without even even us knowing it until sometime they start attacking and they start revealing the power of the botnet. And the reason I depicted the botnet this way is that interestingly in the malware of this botnet, it had a self-propagation mode. And so as it compromised hosts, those hosts would go off and scan for new hosts. And so it just created very quickly this huge network of compromise bots. To produce threat intelligence on this botnet, we need to embed ourselves somewhere inside of this network. You need to get under the covers of this botnet to really understand its weak points and be able to find the infrastructure and understand its tactics. This is where deception technology comes into play. Madpod is our deception technology network, which you may have heard of before. It's been spoken about a few times here and we've also also publicly spoken about it um in blog posts. It is a fleet of honeypots that runs across the AWS network, and these honeypots are interspersed within our public IP space. That means that when bad actors are scanning or enumerating AWS IP space, looking for applications that they know might have vulnerabilities in. They're gonna come across our honey pots and they're gonna fall into our trap thinking that they found something really sweet. Our job is to build these honey pots as realistically as possible. And suc success here is getting the bad actor to reveal his his tactics or their tactics. And by doing that, we have full visibility into the same threats that might be knocking on the door of any endpoint that's accessible to the internet, especially, uh, and not only those that are on the AWS on running on AWS. So in our story, As this botnet was self propagating, as I mentioned. It unknowingly and it unwillingly interacted with one of our senses. one of those bots interacted with our sensor and tried to infect us. This enabled us to capture this payload. So now we've already got visibility into the initial compromise, which is sometimes really difficult to do. Uh, we get this payload and this payload is showing you a lot of things. Firstly, it's telling you what kind of devices it's targeting. You see that system type NVMS 9000. That's a type of of software version that runs on digital video recorders, specifically the TVT brand. And It had a vulnerability in it where if you ran that admin query basic config command. In a certain way, it would return to you a lot of juicy things, including the admin credentials for the device. Now with that, you obviously have the the keys to the front door of that device and you can log in and do whatever you want to do. So, here, um, you know, at some stage, we were seeing around 70,000 interactions a day trying to exploit this. And with MApot pretending to be one of these vulnerable devices, we're able to deceive these bad actors, and this is the first step in our flywheel, collecting this intelligence. Now the crazy thing is, just a random stat I want to throw in here is that TheApot fleet. We don't advertise that anywhere, right? We don't have a page on AWS that says, hey, here's our honeypot IPs, go talk to them. They just sit there. They're not even under a domain name at this point. So you have to scan, you have to find these IPs and you have to talk to us willingly. And that is happening over 1.5 billion times every day. It's crazy the amount of data we're able to collect through this flywheel. And this is just the front door. Now, having the honeypot is not the secret sauce. Anybody can have a honey pot. In fact, it's so easy. You could, you could connect your fridge to the internet. And you've got a honey pot. The real secret source is in how you build the automated workflows that extract the intelligence out of that and turn it into actionable uh mitigation. And now we're starting this portion of the flywheel. Collecting threat artifacts. In this case, for the botnet, we collected the malware. Malware is usually dropped in a couple ways. Um, sometimes it's just embedded directly in the payload as the request is coming in. Sometimes there are links out to staging locations where you can download the malware. We do all of that automatically. We have, we have a feature and an automated workflow that extracts those URLs. It goes and fetches the malware and it stores it locally for us in an S3 bucket so we can analyze that later. And this process is happening over 1.5 billion times a day. Right? Not all of those interactions have malware in them, but there is no way I could have a security engineer sitting there trying to find that. Um. And that's the important thing is automating it. So for this botnet that we were tracking, we found 3 versions of the malware. Those 3 versions were collected over time as the malware was expanding and growing. And then it also covered multiple architectures. Once you've collected the thread artifacts, we, we move on to the the threat analysis phase where now, now is where we required a short amount of investment from my team to engage this flywheel again. So Once we had the malware, you remember all those uh architectures that the malware supported. We needed to enable detonation of this malware in those architectures. That was where we had a once-off investment of security engineering time, ensuring we had the right feature in our uh workflows to support that. The reason why you want to detonate this malware is because it helps you find the treasure. Now, what is that treasure? That treasure is the command and control server. That's sitting there somewhere else controlling every single bot that's on the network. The C2 is the thing that tells the bots who to attack, when to attack and how to attack them. So if you can find that, you found the treasure of the botnet. That's the most critical thing. And by detonating the malware. You observe a lot of interesting things, right? Remember when malware initially plants its roots in a host, what it's trying to do is establish communication with the botnet usually. And that botnet, that, sorry, that establishing of that communication, is it just saying, hey, I'm here, I'm ready to do your will. And We saw that. So in our, in our detonation chamber, we saw this malware reach out to a domain. The reason it was reaching out to Domain is that Domain introduces resilience into a botnet. So one way of doing this is uh one way of communicating with the C2 is by just putting the IP address into your malware. But if that C2 gets taken down, How do you update the software then to put the malware, uh, put the new IP? So by having a domain, you can have more resilience built into a botnet, and that's what we do for applications and that's what bad actors do. In this case, what was interesting Was the DNS query was a text record query. Usually we see a record queries to find the IP. In this case, it was a text record query returning a list of IP addresses. Again, further resilience, giving the malware options, saying, hey, try this, try this, try this. Um, so it was quite, at this point, it was uh quite a sophisticated uh C2 discovery uh mode. We, of course, saw this happening in our detonation chamber, right? In our detonation chamber, we're able to observe exactly what's going on. Again, the key critical visibility you need to be able to get under the hood. With, we saw the DNS query, we then saw the the subsequent uh connections out to the C2. And now you have the treasure. Now you know what protocol it's communicating on, where the C2 is, what port it's on. You can even monitor the responses back, and that gives you a world of intelligence that you would not have had. In fact, when we were monitoring this seat this uh C2, it was initiating, you know, more than 800, sometimes more than 800. It was targeting more than 800 places in a single day. Like this is a 30-day period. I, I picked, um, Can you just imagine that one botnet targeting 800 different places in a single day. And not all of these are on AWS. This is just targeting places um all over the internet. So with this information, if you, with our bot now in our detonation chamber, we're actually observing and collecting intelligence on things that are even outside of AWS. Um, and this is critical. Now, we've embedded ourselves in the network and as that bot was that botnet was growing, we now own one of those, those, um, nodes on that botnet. Um, fortunately, we don't contribute to make things worse, but we use it as a key way to collect intelligence. So with the threat analysis done, Uh, we move on to try to make The turning this, the artifacts and the data we collect from threat analysis into actionable threat intelligence. The important thing here is how do you get your intelligence into some kind of place where it can be used to disrupt bad actor and malicious activities. So, let me tell you a bit about the mitigations that we put in place in order to um In order to disrupt bad actors and and in this case, Adidas botnet. First off, we now route IP addresses. We we now route the C2 IP addresses that we collected across the AWS. Now, what does this mean? You remember those, you remember those DNS queries that we got back from that domain when I was trying to discover the C2? We take those those IP addresses, and we put it in a mitigation that is essentially preventing all of AWS, anything that's running on our network from talking to it. That's quite scary. When we first launched a capability like this, we stayed up all night because we couldn't sleep because we're saying like, no one on this network can talk to the IP address. The blast radius is huge if we got something wrong. So we, as part of our workflows have to verify every single indicator. Make sure that even though we got this IP from the botnet, probe that IP, make sure it's aligns with what our understanding of that C2 is and continuously do that, continuously verify the IP so that, I mean, you heard from Michael earlier, these IPs can change hands and Was it under 3 minutes, right? Like this is, this is something we have to do to verify every single indicator we have before we put it into a Nur root and while it's in that Nel root, so we can pull it out as soon as it's no longer active. The impact of having an IP address, a C2 IP address now rooted on AWS. Is that Um, if there is anything on our network contributing to that botnet. It can no longer do that. It means that if the botnet had somehow worked its way into the AWS network, we're now cutting off that whole portion of the botnet, and no outbound abuses of traffic can be sent from AWS for this botnet. So this is a really big hammer, right? It's a big hammer that we place taking just one indicator that came in that we learned from one interaction that came into Madpots. It's flown all the way through that flywheel, and is now sitting in front of all the AASs preventing the whole, anything on that on the network from contributing. This is a huge one. The second one is attack commands. I mentioned earlier, you know, it's targeting hundreds of places a day. Each one of those attack commands has a destination on it. I want to target this place. Now, this is fantastic information because as Mike said, detection can be challenging if you're trying to do it at scale. You got to collect all the data, you've got to process all the data, you've got to filter all of it, and then you've got to detect and say, OK, this place is now under attack. In this situation where we're getting the attack command, we can bypass all of that because the botnet is saying. I want to hit him. I want to target them and then we already know immediately. Something is about to go down. And so for when we see attack commands coming in. That have a destination for AWS. Any uh domain or IP address that's hosted on AWS we can immediately shortcut that detection cycle and just go straight into the mitigation. It is a super powerful approach to making threat intelligence actionable on the AWS network. And the third thing that we do is uh take down requests. In this situation, what we're essentially trying to do is clean up the internet for everyone. Uh, uh, over time, as we're analyzing and tracking the infrastructure that is, uh, evolved in this botnet, right, we've, we've mentioned a few of a few things already. There's a domain name. That domain is hosted somewhere. There's a list of many different IP addresses for C2s. Those C2 servers are hosted somewhere. We even have the bots that are contributing to attacks that we've seen coming into the network through AWS Shields uh mitigation systems. The bots, the sources of that traffic we have, all of these things are hosted. And they hosted elsewhere on other networks. The ones that are hosted on AWS we can easily just take down. We have automated workflows that drop abuse of within minutes. But for the infrastructure that hosted, that's hosted off off AWS, we can't just turn it off. So we have to send these takedown requests, which is a really, really nicely worded email with all the abuse um information on it, requesting that that hosting provider takes it down. And sometimes networks partner very nicely and they collaborate well, and they work on the intelligence that we have provided them. And other times, that's not successful. But this is really a, a really um a way that we like to attempt to clean up the internet and make it a safer place for everyone. Now the last arrow in this flywheel, I like to refer to as job security. It's job security for us as a security community, right? The better we get at using and building these flywheels. And that the more times that we're able to mitigate more effectively and disrupt bad actors, means that they need to do more work, and it makes it more expensive for them. They have to go back and rebuild their botnet. In this case, we took down C2's, they had to Uh, they had to go and rebuild things. As we were understanding what the malware was doing, they had to go and uh innovate and change things. And so, Um, this arrow is completing the flywheel. The important thing here is that while, as I mentioned at the start, while we were investigating the botnet, it was evolving right before us. So here's an example. Initially, when we, when we captured the malware and it was being detonated, we saw these text record, uh, DNS queries. Those were coming back in plain text originally. It was super easy. We even said thank you. It was just pure gold for us and we didn't have to really do much work. However, a couple of weeks later, the bad actor had updated their malware and we, we received a new, a new hash, a new version of the malware. And in this version, there was encrypted text records. So the responses coming back all of a sudden had some encryption, which we needed to work at decrypting. And after that, a couple of weeks later, we even saw new attack features being added to the malware. So this is crazy. It's like while we were sitting there tracking this bad actor, we were just seeing all the hard work going in from their side. And again, it goes back to the flywheel. We see one thing coming into Madpot, we turn it into this actionable intelligence. It further disrupts them, causes them to rebuild, and the whole cycle happens again. And you heard from Michael how this intelligence from Madpod flows into these mechanisms that are protecting all of EC2. And without this flywheel, We wouldn't be able to power uh those mitigations that reduce the time to exploitation for workloads on AWS. In addition to this Uh, I'd reinvent this year, uh, reinforce this year, sorry, we launched a new feature, an external security feature that uses intelligence from MADON. This flywheel is also powering many different capabilities and external security services. And I'm gonna hand over to David and he's gonna talk you through how um how that is happening and how MADOT is being used in that case. So you've seen how we help protect the AWS cloud with active defense and how we power our intelligence operations with Amazon threat intelligence. I'm going to show you now how you can use that same threat intelligence through our security services. These services democratize access to sophisticated security capabilities that would otherwise require a significant investment to create. First, I'd like to introduce you to guard duty, our threat detection service. Guard duty continuously monitors your ADbus accounts and workloads for suspicious activity. The key here is in the effective transfer of intelligence. When our security teams identify new threats, we work to incorporate that into GRDD detections which help integrates this intelligence into everyday practical security monitoring. To go into greater detail, I'll walk through three example guard duty findings where we've done just this. The first of these is a standard feature that comes with the product, or the latter two are opt-in features. First, indicators of compromise or IOCs. This feature, the command and control finding leverages these IOCs. So if you have a workload which has outbound communications to a known malicious IP address or attempts to resolve a malicious domain name, we will notify you of this activity. When Paul talked about a lot of the work we do in Amazon threat intelligence to analyze threats, we're collecting IOCs as part of this work, and we're providing that to guard duty, so it's used in this native feature of the product. Next we have guard duty malware protection, which is the malicious file finding. This is our agentless base scanning feature in guard duty. This feature can initiate scans through S3 coverage when objects are created or in protecting your EC2 workloads. This covers. This covers either through on-demand scans or through scans that can be initiated by the guard duty service such as the command and control finding indicating the guard duty that scans should be conducted. When Guard malware protection scans for for malware, it is leveraging signatures that we've created as part of the work that Paul talked about where we create malware signatures that are then incorporated in that scanner to notify you of the malware that could be identified in your S3 buckets or workloads. And lastly we have GuarddiD run time protection, which is our agent-based approach to security. In recent years there's been talk about threat actors using living off the land techniques where they use legitimate tools to further their operations. These tools are not malware. They won't be detected as malware because they're legitimate, but we have an agent that will help us collect data so we can analyze the use of these tools to determine if they're being used in a malicious nature. As part of our work in Amazon Threat intelligence, we investigate threat activity and we identify these behaviors and incorporate that into the analytics used by guarded do runtime protection. So I mentioned those latter two findings were opt-in features guard ET malware protection and guard ED runtime protection. I'll walk through how you can enable those features in the AWBS console. I'll also note if you're not using the console, if you're using infrastructure's code such as AWBS Cloud Development kit or CDK or other constructs to manage your infrastructure, you can also configure this these features through those capabilities as well. First, we'll begin in the console. We'll navigate to guard duty. On the left hand side we can see there are many often features that you can enable. We'll start with the malware protection for EC2 feature. We see we have 3 options on the screen. We can enable a service working down from the top. We can initiate one of those on-demand scan options that I mentioned. And lastly, I'll call attention to this toggle option that you have at the bottom, retain snapshot when malware is detected. So for workloads, when guarding malware protection initiates a scan, it is creating an EBS snapshot that is then scanned against to identify malware. You can configure Guard DD to have this purged from your account after to save on cost. However, this feature allows you to say retain the snapshot when there is malware. I highly, highly recommend to enable this. Your incident response teams will thank you for retaining this forensic artifact, so when there is malware, it has data captured that helps further their investigation. Next, I'll walk through some of the features for Guardian and malware protection for S3. We'll navigate to the malware protection for S3 option. We'll walk through enabling. You'll see that it can be enabled on a per bucket basis. You can also filter to a specific prefix as well, and you can use bucket object tagging. So with object tagging this can provide rich metadata associated with the scan, such as the verdict, whether it was determined to be clean or malicious, and other scan options. This is really key for incorporating malware protection into your service. You can leverage all of these building blocks if you are taking in data from untrusted sources if you need this validation to ensure that the corpus of data you're working with is clean and use the same scanner with the same signatures that we're creating through Amazon Threat intelligence to help detect that those files that you're working with are safe. And lastly I'll demonstrate guardian to runtime monitoring. This feature provides just a few options to enable the service. The service takes care of all of the actual agent deployment, configuration and updating for you. All you have to worry about is enabling the feature and ensuring through the runtime coverage option that has been deployed appropriately and the service will handle the rest. Next, I'll walk you through Amazon Inspector, which is our vulnerability management service. Inspector continually identifies workloads and scans them for vulnerabilities and risks and brings that information to you. It includes information on the actual environment it's collected from and it enriches it with vulnerability intelligence from Amazon threat intelligence. This helps ensure that the results that are brought to you are prioritized so you can focus on the highest impact risks first. This lets you make an intelligence-based risk assessments based off those in your environment. I'll demonstrate a feature of Inspector that again is available either through configuration with CDK or also it's accessible through APIs. So first we'll navigate in the console to inspector. On the left hand side will highlight the vulnerability database search feature. And then we'll provide a CDE identifier, a unique identifier for vulnerability. We can see on the screen this is enriched with several different data sets. We have information from the National Vulnerability Database. This includes the description and other rich metadata. This also includes from the Cyber Security Information Security Agency, or CISAS, known exploited vulnerabilities catalog if there's been exploitation reported by CISA. It also includes Amazon first party intelligence. So when we've seen exploitation attempts to places such as Mad Pot, we report this through Amazon Inspectors vulnerability database search feature providing you that information. We also provide any industries we see that were targeted with this exploit. This helps you make intelligence-based risk assessments and one of the really things that I wanna highlight here is that. This is a feature we proactively provide. All of these vulnerabilities that we, the information that we exposed to you through this feature can be used to not only protect your resources on the AWS cloud, but it can be used to protect resources off the cloud like end points. So if you have vulnerabilities and you want to see what other information you can gather on that, we provide this to our inspector customers and that's all sourced from Amazon for Intelligence and other sources. If you have a workload on AWS, then inspector scans and it finds a vulnerability within that workload. This is an example of the finding that's generated for you that you can review. It includes information like the last time we observed an exploit attempt if there's an exploit available. It also includes other rich metadata which we aggregate with a third party such as the minor attack tactics, techniques and procedures or TTPs. So again, you can take that intelligence and use that to make intelligence informed risk assessments. Next, I'll introduce you to web application firewall or WAF. This can be configured to protect your web applications from common web exploits. And bought activity this can be used to protect everything from cloud front distributions to API gateway deployments to application low balancers and other resource types. One of the capabilities I'll note is the ABS managed rule set that we provide from Amazon Threat intelligence. This includes curated intelligence that is continually updated through our security research activities. Just yesterday we announced a new enrollment experience which greatly simplifies the process for onboarding to WAF. When you onboard through WAF you can see there's many options on the screen, but toward the bottom here we have the Amazon IP reputation list. This reputation list includes IP addresses collected through that work that Paul was talking about previously, which can protect against malicious inbound activity to your services. And lastly, I'll show you an AWS network firewall. This firewall protects your virtual private cloud or VPCs from their activity. Notably, this doesn't just protect against inbound activity, it can protect against outbound activity too, like beacon attempts to malicious command and control infrastructure. Also, this provides both stateless signature-based detections, as well as stateful, being able to correlate across multiple sequences, multiple packets, and events that are being collected at the network firewall edge. Just yesterday we also launched a new capability, Active Threat Defense, which integrates with both Adibus network firewall and guard duty. This takes all of that rich Amazon threat intelligence and includes IP addresses, but also rules and other rich data that we're aggregating together and makes it available through guard duty for detection purposes and AWBS network firewall for mitigation purposes. It's continually updated based off the threats we're seeing, and it includes a new feature, deep threat inspection. With deep threat inspection, this enables shared threat threat data. So if a threat is observed against one customer using deep threat inspection, that is collected and analyzed and helps protect all customers using the same feature. I'll demonstrate an example of what a finding looks like from guard duty with active threat defense. If you recall those first three findings I showed you before, the very first one, command and control finding, that was an example of outbound attempted beacon activity. If you have a a workload which attempts to communicate outbound to a command and control server that we've identified through our active defense work. You will receive a guard finding you know you can know this is from Active Threat Defense or reviewing the finding threatless name. This also includes the threat name, the specific metadata around the actual IP address or the domain name that we have in this case a cobalt strike command and control server. The key here I'll note is that Guardity provides detection capability. It covers network logs, such as in this case, it covers other logs at Cloudtrail. It covers the malware protection and runtime protection features, all these different log sources I mentioned. But for a network activity if you couple guard duty with network firewall with active threat defense, you can actually stop classes of malicious threat activity. So in this case, this command and control beacon activity can be completely stopped by using network firewall with the same workload. And so by using both of these solutions together you receive protection against classes of threats and then detection against other classes of threats. And so I'll demonstrate how you can actually enable active threat defense with network firewall. Again, we'll walk through doing this with the console but you can do all this through CDK and other constructs as well. And the console will navigate to VPC. We'll scroll to our firewall policy in this case one that we've already created. We'll navigate to the state for row group section and add a managed state for row group. And at the top we have our active threat defense feature. This includes all the Amazon threat intelligence we've been talking about the rules, the IP addresses, the domains, all of that which is constantly being updated and provided to you. Once you've all added this that firewall policy, all you have to do is apply it to the relevant BPCs and you'll receive protection from Amazon Active Treat Defense. To wrap up today's discussion, you've seen how Amazon, you've seen how we help protect the cloud with active defense, how we power our intelligence operations with Amazon threat intelligence, and how you can leverage that intelligence through our security services. This is security democratization and action. Enterprise grade protection is available to all customers regardless of your organization size. Thank you for your time today and please complete the survey the session survey in the mobile app.
