# AWS re:Inforce 2025 - Serverless threat response for Amazon S3 malware detection (COM222)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=WuDLqY3mt1U)

## Video Information
- **Author:** AWS Events
- **Duration:** 14.1 minutes
- **Word Count:** 1,954 words
- **Publish Date:** 20250618
- **Video ID:** WuDLqY3mt1U

## Summary
The presentation focuses on implementing automated malware detection and threat response for Amazon S3 uploads. The speaker introduces Amazon GuardDuty malware protection for S3, a new feature that automatically scans objects uploaded to S3 buckets for malware threats.
The core of the presentation demonstrates a serverless architecture that combines GuardDuty with AWS Step Functions, Lambda, and EventBridge to create an automated workflow for detecting, quarantining, and responding to malware threats in S3 uploads. This solution provides real-time protection while remaining invisible to end users and requiring minimal security team intervention.

## Key Points
- S3 buckets, despite having strong default security features, remain vulnerable to malware uploads from users and applications
- GuardDuty malware protection automatically scans new S3 objects and applies tags indicating their threat status
- The solution focuses on monitoring client-facing upload buckets rather than internal storage
- Automated response workflow quarantines suspicious files and removes them from production environments
- The architecture is scalable, modular, and can be extended with additional security controls and notifications
- Implementation requires zero waiting time for users while maintaining security
- Security teams can receive automated notifications and incident tickets for investigation

## Technical Details
- Amazon GuardDuty malware protection tags:
  - threads_found
  - no_threats
  - unsupported
  - access_denied
  - failed
- AWS Services Used:
  - Amazon S3
  - Amazon GuardDuty
  - AWS Lambda
  - AWS Step Functions
  - Amazon EventBridge
  - Amazon DynamoDB (optional)
  - AWS Systems Manager Incident Manager (optional)
  - Amazon Security Lake (optional)
  - Amazon SQS (optional)
- Implementation Components:
  - S3 event notifications configured to EventBridge
  - EventBridge rule triggering Step Functions on PutObject
  - Lambda function for checking object tags
  - Quarantine bucket for isolated malware storage
  - Automated cleanup of infected files from source bucket

## Full Transcript

Hello everyone. Welcome to my session today for So threat response for Amazon S3 malware detection. Uh, I hope you have a great time at reinforce. Today is my first time as a speaker and attendee, so I'm really excited about it. Uh, before we start, I want to introduce myself. Uh, I am Senna. I am from Turkey. I am working as a cloud security architect at Cybervis, and also I am an AWS security hero like almost 2 years. So this is our agenda today, and I want to start. something we all use, event in applications, whether it's uploading a selfie or syncing a backup or uploading a scanned documents, actually we are using, we are sending some data to Amazon S3 or we are getting some data, Amazon S3 from everyday. So millions of objects uploaded to Amazon S3 every single day from your applications or from your customers' applications actually. So there is a what if, uh, what if just one of those files is just malware. So again, it can be a zip file with some bad codes or it can be a PNG or image file with some Trojan. I don't know. Maybe you have your, your system has an upload vulnerability that has some misconfigurations into your back end and something or someone is trying to or sending to some data, some code, some execution process into our back end. So, as we know, and as you know, Amazon S3 is secured by default with lots of different good features, uh such as uh encryption for the new objects by default or maybe disabling the S3 access control list by default or maybe for the public access because the public access is the most dangerous one. We can get automatically enabling for S3 block public access features. But none of them is not solving the problem because when you are uploading some stuff, when you are allowing to upload your clients to Amazon S3, it can be a nightmare and it can be an initial endpoint for your system and actually attackers know that. So, just for a second, we need to think how do we detect these threats, and we need to respond instantly and our clients and our users shouldn't have to care and shouldn't have to wait for this process. So, at this point, we have a great feature which is uh newly released by Amazon Gartuti malware protection for Amazon S3. It's a really, really great feature because if you just want to use this option, you can only use that option. You can enable just only this option. Uh, for the, uh, for the S3 objects, for the S3 buckets in your environment, and you can also send lots of scanned metrics to the event bridge if you want, or Amazon Guard 2T scans your newly uploaded objects every day in real time and we are getting some tags for the new objects. Like if you have some objects that has some threads. GART is, uh, guard TT takes it as stress fund. And if it is not, it's uh OK. uh guard duty again takes no threats. And if you have some files that guard duty is not supported, we can get the tag unsupported. And if you have some access issues about uh guard duty and between your S3 buckets, you can get access in ITech and if you have some failed scans for your new objects, you can get the failed state failed. object key actually. So it's really good and as you can see, you are getting lots of different data for the finding in the Amazon Guard duty, which is really cool feature for the S3 buckets for the user uploads. So just for a second, let us think together. It's just for the detection part. Yes, we are detecting some stuff, some malware. We are detecting what the issue is, what the IP is. We are getting the finding, but it's only the detection part. We don't have to get any take action. We don't do any investigation or we don't send some notifications to the security team. So at this point we need to think an automated, fast, and invisible solution for the guard duty for the threat response mechanism. So at this point, I have created a solution that you can use uh for your services and automated approach for the action and for the investigation. So I want to uh summarize, uh summarize the steps for you. Uh just first of all, I have enabled the guard duty protection option for my SE buckets. These 3 buckets should actually the buckets that our clients uploads, so I have lots of visibility because I have, I just need to focus on the uploaded ones, not the unnecessary scans, not the internal ones or the private buckets that users don't upload. I don't want that. I just need to focus on the client's interactions. And after that, I have enabled the S3 events notifications to send all notifications to EventBridge. And after that step, I have enabled an eventbrid rule, which is whenever a client uploads some stuff, which is put object, I need to run AWS step functions. At this point, AWSF functions is really, really good feature for me, good service for me because I created a flow. That can be manageable automatedly, fastly and invisible for the users. So at this point, what can we do? What can I do? I have a lambda function which is named as check object tag. As I said before, guard duty adds some tags for the new objects that you are scanning with the GARTT feature, and this lambda is basically controls the tag. And if you have the threads found tag, you can call with this automated flow with the AWS step functions. You can call quarantine if the threads found lambda. At this point we need to get the malware objects from the original bucket and we need to we need to send them to the quarantine bucket because we need to investigate what's the issue. We need to do a forensic analysis for the object actually. And after that quarantine, if the trade funds lambda deletes the Delete the original objects from the client site because we don't need it. We don't want to run it like if you have a mobile app with the AI generated images, you don't need to go to another step with this object, with this number with this image because it's already maled, so we need to quarantine that. And after that, if you have the tag, no threads found, and if you have some business logic like generating an AI image or this kind of stuff, you can just move on. But if you want, you can tag this like, yes, this is the this is the clean object you can move on. You can send some send some notifications or you can send all of this stuff to the SQS. I don't know, whatever you want. And if you want to add some custom logic with different uh tags such as if you have some access denied or unsupported and you need to be aware of it, you can do also lots of different options with lots of lambda or maybe lots of different uh AWS server services. So at this point, as you can see, there are a few key benefits for this architecture. First of all, it's all automated. We don't have any security engineers at this point. We just need to focus on the logic and the business flow at this time, and it's scalable. You can add whatever you want, whenever you want at this architecture, and it's silent for the clients, for attackers, and for the normal users actually. Uh, And after this point, yes, we have quarantined all the stuff that we want. And what if? After the quarantine step, we can focus on the notify the security team or doing some deeper investigation or creating a security ticket to your security team actually you can do again whatever you want. It's so modular and it's scalable. So for example, you can send an alert with. An SMS to your third party solution or maybe with the email to your colleagues or if you want you can get some data from the Amazon guard to defining details and you can write all of them to the Amazon Dynamo DB or Amazon Security lake or another that you want whenever you are storing some stuff you can do it. And if you want, you can also do AWS systems manager, incident manager to uh create an incident ticket for your security team and they are getting some calls about, yes, there is a malware object, you need to be aware of it. You need to do this step, this step, and this step. You can also do this. And if you want, you can call another AWS step function flow to get some deeper investigation for your system. So at this point maybe you have already seen or maybe you have some questions about how this architecture works. First of all, it's surless as you can see there are lots of different service services and we just need to focus on the code. No patching, no management, we are management, and we just need to focus on the business logic and actually the guard duty tags and we can just move on. And after that, it's invisible uh for the clients, for the attackers, and we just need to understand the whole flower as cloud security architects or security engineers and we just need to move on with this. And it's event driven. I don't want to get a malware object to the second layer, to my backhand. So at this point it's really it's a real-time job. We just catch the bucket. We just catch the object. We need to quarantine it and after that we just need to investigate it. If someone is getting some bad stuff in our back end, we don't want to allow it and which is really important because event-driven applications is really, really popular and we have all use all of the systems, all of the integrations in real time. And it's scalable. We are doing lots of different things with SMS systems managers, this kind of Amazon Dynamo. I don't know whenever or wherever you want, it's more scalable and if you are uploading just one of these files or millions of objects, it can be scalable with different AWS step functions or with different lambda. You can do whatever you want. And finally, it's extendable and modular actually. You can get some stuff, some here, uh, and you can add some uh custom or business logic into your system and you can move on. So at this point, finally, I want to say detection is really good. And automated response is better. We can find a solution for the automated response, but for your event-driven applications, uh, invisible, which is your clients does not care about or does not know anything about it, and service protection, that's how you can win for the event-driven applications. So thank you for listening. Uh, if you want to reach me or ask me any questions, I will be around here, uh, for like 3 days, and these are my, uh, Twitter and LinkedIn. You can, you can follow me from here and I just want to ask, please complete the session survey in depth. Thank you so much for your, uh, attending.
