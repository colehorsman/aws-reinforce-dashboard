# AWS re:Inforce 2025 - Securing AWS networks: Observability meets defense-in-depth (NIS306)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=J5RwvzaQgvo)

## Video Information
- **Author:** AWS Events
- **Duration:** 52.6 minutes
- **Word Count:** 8,204 words
- **Publish Date:** 20250621
- **Video ID:** J5RwvzaQgvo

## Summary
This comprehensive presentation explores AWS network security strategies, focusing on building a defense-in-depth approach to protect cloud infrastructure across evolving architectures from single VPC to multi-account environments.

## Key Points
- Network Security Challenges:
  - Constantly changing threat landscape
  - Distributed workloads
  - Lateral movement risks
  - Limited visibility
  - Compliance consistency

- Fundamental Security Constructs:
  1. Security Groups
   - Stateful
   - Resource-level protection
   - Implicit deny by default

  2. Network Access Control Lists (ACLs)
   - Stateless
   - Subnet-level rules

  3. VPC Block Public Access
   - Declarative traffic control
   - Regional and organizational policy enforcement

## Technical Security Strategies

- Traffic Protection Mechanisms:
  - VPC Endpoints
   - Secure private service connectivity
   - Gateway and interface endpoint types
   - Granular access policies

  - Web Application Firewall (WAF)
   - Protect against malicious internet traffic
   - Custom and managed rule sets
   - Multi-language threat detection

  - Network Firewall
   - Inspect incoming and outgoing traffic
   - Scalable to 100 Gbps
   - Support for 50,000 rules
   - Stateful inspection

  - DNS Firewall
   - Block malicious domain queries
   - Centralized DNS security management
   - Integration with threat intelligence

## Observability and Governance

- Key Observability Tools:
  1. VPC Flow Logs
   - Capture IP traffic details
   - Multiple logging destinations
   - Cost allocation and compliance

  2. Reachability Analyzer
   - Validate network connectivity
   - Hop-by-hop path analysis
   - Firewall rule verification

  3. AWS Firewall Manager
   - Centralized security policy management
   - Cross-account policy deployment
   - Resource compliance monitoring

## Recommended Architecture Approach
- Implement defense-in-depth strategy
- Use multiple security layers
- Centralize security controls
- Continuously monitor and validate
- Adapt to evolving infrastructure complexity

## Best Practices
- Combine multiple security controls
- Enable comprehensive logging
- Centralize security governance
- Regularly validate network paths
- Implement consistent policies across accounts

## Full Transcript

All right. So let's take a step back before we go and jump into and start learning with the services. What are the challenges our customers are facing today? The first of is the threat landscape, which is constantly changing. We are seeing anywhere from the ransomware attack to the DDoS attack, and these attacks are happening in each and every layer of your stack. Whereas the network layer is still the biggest target by these attackers. Second is a lateral movement. Nowadays our users are working from the remote locations. They're not just sitting in your corporate network. Which became another challenge for the network security teams because now they need to protect those end points, those locations in a similar fashion they are protecting your corporate networks. Third is the visibility. What you cannot see, you cannot protect it. Nowadays our workloads are so distributed we have the multi-region multi VPC, multico hybrid environments, multi-cloud environments. Getting a complete overall picture of all the workloads, how they are working together, how the traffic is flowing is another challenge by the network security teams. And everything being so distributed, staying compliant and applying a consistent policy throughout your organization or across the board is another challenge faced by the network security teams. And these are not just the theoretical challenge we're talking today. These are the real problems which we heard from our customers, and in today's presentation we're gonna show you what are the different network security tools are available for you which you can use to take a difference in depth approach and protect your applications. So let's start the conversation with the very foundation 3 tier architecture where most of the customers start with. It's an application running in my 3 tier spread across two availability zones for high availability. I have my app layer and the database layer running in my private subnet fronted by elastic load balancer, and we have a a gateway for my internet connectivity. Now let's see what are the different services you can use, which you can use to take a defense in depth approach to protect and enhance the security posture of your application. So one of the fundamental security tools available within the AWS is the security group. Any resource which is running inside your VPC with an ENI requires a security group attached to it. These are implicit deny by default, which means that Any traffic coming in will be denied by default until unless you add any rule to the security groups. So how it works? You have a traffic coming on port 443, hitting your elastic load balancer. Here we can add a security group and we can add rules stating that traffic coming on port 443. Only the traffic coming on port 443 will be allowed. And if that coming from the source IPV4 and IPV 6 sided range, those traffic will be allowed. Next, my traffic is hitting my instance layer. I have another security group where we added the rules stating that any traffic coming from the elastic load balances security group on port 80, only that traffic will be allowed. Security groups provide a feature where you can have multiple types of sources like in the first example we use that cyber range. In the second one we are referencing a security group. So you can reference another security group from the same BPC or any other VPC which is part of a different VPC which is paired with this or connected via the transit gateway. And you also get an option where you can use a prefix list. So if you have a list of IP addresses from where you want to allow list the traffic, you can create a prefix list for those IP addresses and you can use that prefix list in your security group source. Then your traffic hit your database layer. Here again you can protect your database layer by adding the rules in the security group, and you can allow list only the traffic coming from your instance layer. So any traffic coming outside of the instance layer, suppose directly from the internet or from the elastic broad bands or public subnet, that traffic will be blocked because of the road. One other feature about security group is that these are stateful in nature. What does that mean that any traffic coming in will get evaluated by the inbound security group rules, but the traffic won't get evaluated, that will go freely. All right, so we talked about security group which helps you to protect your resources. Now the other security construct we have available is the network ACLs or network control access control list. These are stateless in nature, which means that you have to write both inbound and outbound rules to protect your application. So anything coming in will get evaluated by your inbound rules. Anything return traffic or going out traffic will get evaluated by your outbound rules. Comparing with the security groups, network ACLs work at the subnet level, whereas your security groups work at the resource level. So you use the network ACLs to write the general, the broad level of rules to protect your subnet, what kind of traffic can come in, and then you can write fine grain control rules at the resource level in your security groups to control that what traffic can hit those resources. All right, so we talked about security groups and network ACLs which work at the resource and at the subnet level. Now let's talk about how you can protect your application at the VPC level, what kind of traffic can come in and not. For that we can use VPC block public access. VPC block public access is a single click declarative control. By using which you can control all your inbound and outbound internet traffic. So the way it works that you go to the VPC setting, you enable your VPC block public access. When you do it once it's active, it blocks all the internet inbound and outbound traffic across all the VPC in that account for that particular region. Now there's certain workloads which are critical and you don't want to block the internet traffic for those ones when you're enabling it for that you can always define the exclusions. You can exclude a particular subnet or a particular VPC. So once you do that, so only those excluded VPC or subnets will be allowed to connect to the internet, others will be blocked. Now the question comes that hey, I'm doing at the account level for a particular reason, but I am under attack and I need to block all the traffic for my whole organization. You can do that as well. You can write the EC to declare to control policy at the org level where by which you can control all the. Inbound and outbound traffic for all the BPCs across all the regions across all the accounts. You can write this policy to find the target which can be your OU single account, multiple accounts, whatever you want to do it the way you write the other SCP policies, and that's how you can control the traffic for all the BBCs. Next, VPC block public access also provide you the VPC level floor log, uh, floor level visibility where you can go to the cloud watch floor logs and find out that why your traffic was blocked or rejected or approved. Like in this snippet you see that we have both ingress and egress traffic pattern rules where we're seeing the traffic is blocked and the reason for the block is the VPC block public access. All right, so we talked about how we can protect our resources within the BPC. What kind of traffic can come in and out. Now we have use cases where we want to connect to some AWS services and we also have use cases where we want to connect to third party application and we want to do it in a secure and private manner. Normally all this traffic goes over the internet, but that could be security and compliance concerns. So how we protect it, how we can make sure that this traffic is not traversing through the internet and is going privately. That's where the VPC endpoints comes into the picture. We have two types of endpoint, gateway endpoint and interface endpoint. Gateway endpoints helps us to connect to the two of the services, S3 and Dynamo DB. The way it works that you create the gateway endpoint, we update the route table by adding a route saying that any traffic going for S3 or Dynamo DB prefix list will go via the gateway endpoint. And once you do that, your traffic is falling, not via the internet, it's taking the Amazon backbone to reach to the services. Second type of endpoint is the interface endpoint. This type of endpoint can be used to connect all the, not all the, most of the AWS services that includeS3 and the Dynamo DB as well. And the way it works is that when you create the interface endpoint, we drop an ENI into a subnet and all your traffic routes through this ENI over the Amazon backbone connecting to your AWA services. Now the question comes like what about the third party applications. So the third party application, the provider can create an endpoint service by putting their application behind a network load balancer and give you an endpoint service name and using that, you can create an interface endpoint for which again will drop an ENI into a subnet and your traffic is routing through the ENI on the Amazon backbone and you connect to these applications. So we discussed that how you can route your traffic instead of routing via the public internet or Amazon backbone, how we can secure it. Now the question comes that hey, how can I make sure that what kind of traffic can go via these end points, how we can control that? That's where our VPC endpoint policies comes into the picture. Like in this example we have a VPC endpoint policy which states that. I can, uh, only the traffic for certain actions and for a particular bucket can go via these end points. Other traffic will be rejected. And on top of that, you can also control these things at the resource level. If your resource allowed to write a policy like in this case S3, we write a bucket policy mentioning that only traffic coming from a particular endpoint and for these actions are allowed. Similarly for the third parties as providers, it does not support the policy, but the provider can control that what kind of traffic can come or who can access their services by adding some rules like uh they can allow this particular account or particular or you or particular principles. All right, so so far we ensured that our workloads are secure and privately connected. Now the question comes that. The lot of traffic which is still coming in our application from the internet and not all the traffic is trustworthy. We have both kinds of traffic, good traffic as well as bad traffic or the malicious activities happening through the internet traffic how we control it, that's where my. That's where our VAF comes into the picture. VA helps you to protect your application from the malicious activity happening over the internet traffic. It blocks based on the traffic pattern you have defined. Based on those traffic patterns, it blocks out the malicious activity and only let the good traffic going to your application. How does it work? So we start by creating the web access control list where we add rules, and AWS provide a lot of flexibility while adding these rules. You can write custom rules or you can use AWS manage rules or the third party rules. While creating AWS uh customer custom managed rule, you can have options like you can write rule based on the IP sets. You can write regular expressions comparing some fields from your HTTP header. You can also write SQL injection rules and so on. You also have an option to write or use AWS manage rules where AWS manage these rules and keep on updating these rules based on the latest and newest trends. And in addition to that, you have the option to use the third party rules as well. Once these rules are created and WebSCL is created, you can integrate it with multiple edible services like in this case, we have elastic load balancer, uh, verified access, A sync or Cognito and so on. And once it's integrated, any traffic coming for your application fronted by these services, your VAF rules will be evaluated and then the traffic will be blocked based on the traffic pattern you have defined. In addition to that, you can also send this all this traffic or logs to the cloud watch or any third party provider by using the Canisius Fireforce. Now our network security team most of the time they spend a lot of time while protecting your application. They keep on analyzing the traffic coming in from the internet and based on that traffic they find out that what kind of rules they need to write to block the traffic. That's where the traffic overview dashboard comes into the picture and that can help them to analyze the traffic. Traffic overview dashboard give it full visibility that what kind of traffic is coming from the internet, whether it's a bot attack or is coming uh from the devices or is coming from the mobile or particular country or IP range those kind of things based on this information they can. Right rule in the real time and block the traffic. One of the example I can put here is that your application is not running a certain country on the mobile device. You have not launched it, but your network security team is seeing that the traffic is coming from that particular country by using the apps. That means there's a malicious activity happening. They can quickly go and take actions based on this data and protect your application. These dashboards are available by default, but if you want to customize the dashboard, you can do it based on the metrics which matters most to you. Here's the QR code. If you want to learn more about the traffic overview dashboard, you can do that. With that, I'll hand it over to Amish who will talk about the network firewalls. All right. Thanks, Ankush. So, we just saw how web application firewall helps you protect incoming HTTP and HTTPS traffic requests. Customers ask, how do I protect other protocols such as SSH traffic or SMTP traffic. Customers also have workloads that need access to the Internet. And they normally ask, how do I protect outbound communications? These are, you know, workloads that are trying to access Docker images that are in public registries or calling third party APIs for payment processing. They want to monitor and inspect these outbound connections. We have a solution for that. Customers use AWS network firewall to protect both incoming and outgoing traffic from their VPCs. They define their security intent using network firewall rules. And network firewall will now start monitoring anything that is going in and out of your VPCs. So I'll come back to this slide shortly to explain how you can insert network firewall in this architecture, but let's first look at what is AWS network firewall. It is a managed service that allows you to deploy essential network network security protocols on your VPC traffic. So, the service automatically scales up to 100 Gbps per availability zone based on your traffic volume. Which means you don't have to worry about managing the security infrastructure of the firewall, as well as you don't have to worry about any of the software maintenance, uh, that, that are needed on the firewall. Also, it has a flexible rule engine which allows you to customize your rule that are unique to your workloads requirement. It supports up to 50,000 rules per firewall, uh, which you can write to match against any port numbers, protocols, fully qualified domain names. Behind the scene, it supports Surikatta engine, so you can write custom rules. To match any traffic characteristics such as packet size or bye match patterns, depending on your use cases. We also offer a fully managed list of domains and thread signatures, which you can use in your firewall policy, so you don't have to manage your own set of bad domains and IP address lists. Let's look at some of the common use cases for AWS network firewall. Typically customers deploy firewall to protect outbound traffic. Say you have workloads that need access to the Internet to talk to GitHub. Once you open access to the Internet, it also opens a back channel, potentially which a bad actor can use to deploy malware and exfiltrate data. Network firewall inspects these outbound connections. And make sure this traffic is not, these connections are not going to command and control centers. You can also build your own restrictive list such that your workload can only talk to trusted destinations. Then for inbound filtering. Customers are worried about. Um, vulnerabilities in their software which which can be exploited. Right, so here they use as we see, web application firewall to prevent incoming web request at the edge, but they also deploy network firewall in addition to web application firewall as a defense in depth mechanism to have consistent security across their web and non web traffic protocols. Using network firewall, they use the built-in stateful inspection engine, IDS IPS capabilities and protocol detection capabilities to only allow access to trusted resources so that you can prevent intrusion and maintain compliance requirements. For east west segmentation, the primary worry for customer is. How quickly an attacker can expand across their infrastructure once they are able to break into one of their applications, so they want to create segmentation they want to make sure that my resources are only allowed to talk to other resources which I permit them to. Everything else should be divined uh denied. So here they use built-in microsegmentation capabilities of AWS network firewall using features like resource-based tags, tags, which can be used in your firewall rules. So you minimize that attack surface in your infrastructure. These are some of the constructs in AWS where you can deploy a firewall to inspect traffic. So you can inspect traffic between two subnets of a VPC. You can inspect traffic across VPCs, which are deployed in the same region. Or you can also monitor traffic between VPCs across two different regions. So these are all your east-west traffic inspection use cases. You can also use firewall to monitor north-south traffic, so any traffic going out to the internet or coming from internet to your workloads. And finally, if you have resources that are sitting on premises and need to talk to your cloud workloads, you can inspect this traffic using network firewall as well. For example, traffic that is coming over a direct connect link. So how do I insert network firewall for traffic monitoring and inspection uh purposes? Network firewall is just a bump in a wire. So if you want to inspect traffic, all you have to do is route traffic through that firewall endpoint where you have defined your security rules. So in this example, if I want to monitor incoming traffic through network firewall, I will change my route table on the public subnet. So any traffic that is coming from internet gateway, it is routed to the network firewall endpoint for policy inspection. I also modify my route table on the network firewall, so that it knows which are my private subnets, so that when the traffic is inspected and it is allowed, it will be sent to the right destination. Next, similarly for east-west segmentation, say if I have two private subnets, one for my EC2 instance, the other subnet where I have other VPC where I have my database, I can route traffic between those two private VPCs through network firewall as well. And similarly for outbound traffic from my EC2 instance, it is first inspected by network firewall and then going out via IGW. Now let's look at some of the deployment models on how usually customers deploy and do the traffic inspection. So centralized inspection is one of our common deployment models where you have an inspection VPC. In that inspection VPC you deploy a network firewall. In this model, you have a transit gateway that helps you route traffic from your application VPCs to the inspection VPC where your firewall is so that it gets inspected first. Only then if it is allowed, it is sent to its destination, which can be any other VPC or it can be out to the internet. This is a common use case, um, for example, you need a centralized egress, right? Everything that goes out to the internet, you want to monitor them using firewall, you do the, do it with this model. The other model that we support is distributed deployment. In this in this deployment you actually deploy a firewall endpoint in each of your VPCs. Say you have special workloads that needs needs to be isolated from everything else and you want to have specific policies for those workloads, you deploy firewall in that VPC. This also minimizes the blast radius. So if something happens when you change your firewall policy, it will only affect that particular VPC. We have customers who have deployed both models depending on their workloads and use cases. So both of these, you know, they have their pros and cons and happy to discuss this offline if you want to dive deep on this. But if we focus on the distributed deployment model, in this model, you have one firewall endpoint. Uh, which is deployed in each of those VPC. Well, it gives you that flexibility, but as you scale your architecture and add more VPCs. You have to add more firewalls, which in turn can increase the cost of your firewall endpoint. To help customers who are deploying distributed deployment, but bring down the overall cost, we introduced multiple VPC end points per firewall. So with this capability, you can actually now have multiple VPCs that are sharing a single primary firewall. So you define the rules in the primary firewall which are shared across these VPCs, and you can share this with 50 VPCs. So up to 50 VPCs can share a single firewall, and these VPCs can be in the same account or they can be in different accounts but in the same availability zone. So by doing this, We are bringing down the cost of firewall endpoints because now the secondary endpoints that are sitting in the VPCs. They are at much lower cost than your actual firewall end point. So this bring down the cost and also the complexity of managing rules across all firewalls. In order to implement multi-VPC feature, you log into your network firewall console. There is a new construct called VPC Endpoint Association. This is where you select the firewall and the VPC you want to associate with. And the availability zone where you want to deploy this endpoint. Once you do that, you will now see the mapping between your VPC endpoint and the firewall it is associated to. And as I said, you can have up to 50 of these VPC endpoints now sharing a firewall. So these are all the innovations that can help you to protect incoming and outgoing traffic from your VPCs. Now let's look at some of the monitoring functionalities that can help you keep your workload secure and see what's going through your network. So when traffic flows through firewall. You can have the firewall log that traffic using the firewall alert log, which can be sent to Amazon Cloudwatch, Amazon S3, or can be further analyzed using Kness's fire hose. Previously, Network firewall was only generating alert logs when your traffic matches a reject rule, a deny rule, or an alert rule. Earlier this year, we also introduced a functionality that allows you to generate an alert rule for any traffic that matches your pass action rule. So, highly regulated customers who want to monitor all traffic, you can now. Um, generate alert logs for your pass action rules as well. So pretty much you get complete visibility into everything that is going through your firewall. Now, in this alert log, you will see the name of the firewall and the availability zone where it is deployed in. You'll also see the traffic parameters such as IP addresses, protocols, port numbers, and the action that the firewall took. So using all this insight, you can, you know, have much more granular view of the traffic profile and update your policies accordingly. To further simplify your operations and give you visibility. We launched a feature called automated domain list features. Now, for those of you, uh, who have used firewalls in the past, you may know how difficult it is to come up with a list of an allowed trusted domain. Typically it takes weeks. To do log analysis and build that allow list to make sure that your workloads are only talking to trusted domains. With this feature, we simplified that by giving you visibility into all the domains that your workloads are talking to. It helps you improve your security posture, and in some cases, maintain your compliance requirements. All you have to do is enable the traffic analysis mode on network firewall. So this is just a one click check box, and when you do that, network firewall will start monitoring all HTTP and HTTPS traffic that is going through that firewall endpoint and generate a report of all the domains that were accessed by your workloads for the last 30 days. So here is an example of a report that was generated, which helps you monitor all the domains. The frequency that is the number of time these particular domains were accessed from your workloads and the number of unique users or the workload ID that were trying to access uh these domains. You can also get a time stamp on when this domain was last accessed. And it's not just this. What makes it powerful is with one click, now you can convert these domains into an allow list, which can be added to your firewall policy. So extremely simplifying on how you build that allow list to, um, you know, secure your workloads. Next, We also announced in native monitoring dashboard on network firewall console. Now visibility has been one of the key pinpoint that customers have reported in the past, and they needed more data points in terms of what's going through my network. With this new monitoring dashboard, you can now see a summary of total connections that are going through a firewall. You get visibility into top talkers, so these are all the flows and you can filter them or sort them based on source IP address, destination IP address or port numbers, protocols as you wish. For example, like we had a customer who. Who are not sure why their firewall charges were increasing and you know which workloads or which sources are processing more traffic. Now they can easily find that data using this dashboard. You can also see how your firewall rules are blocking and rejecting domains so that you see, you know, like which rules are trying to block which domains and you know how often these domains were accessed through my network which were blocked by firewall. So with all this insight, it helps you again optimize your rules, make sure your workloads are secure. Finally, we also have new flow management features such as flow capture and flow flush that helps you with your monitoring and troubleshooting requirements. Flow capture allows you to get a comprehensive visibility into active network connections. On the other hand, flow flush will allow allow you to terminate selectively certain flows, or you can terminate all the flows from the firewall state table. These features are extremely valuable when you are doing your routine monitoring, troubleshooting or policy updates or when you have a security incidents and you know there is a need to isolate certain workloads which are. Suspected to be compromised. By using flow flush and flow capture feature. You can effectively monitor all the active flows, you can quickly respond to security events, and also verify that an updated policy is enforced on your active connections. So you can capture, you can create a flow filter to capture traffic based on parameters such as IP address, source and destination IP address, ports, protocols, and once you start capture, you'll actually see all the network flows that are currently active. So now that you have visibility, you can, if you want, terminate these flows, and when you terminate them, the edge of the flow resets that tells you that, OK, you were able to terminate those flows, and now they now start matching against an updated policy. So with that, I will hand it over to Anand to take you through the rest of this session. Thank you. All right, thanks Amish. So, uh, we just saw how AWS network firewall can inspect traffic at the IP and port level. Now, let's shift our attention to a different kind of protection, which is DNS level filtering. So, in many enterprise environments, threats don't always come in the form of open ports or malicious IPs. It can start with a very simple DNS query to a malicious domain. So let's understand this with an example. So let's say in our architecture an instance is trying to uh query a particular domain name which is example.xyz and before the instance can actually connect to that particular domain, it needs to resolve that particular domain to an IP address. So when you make a DNS query, it goes to the VPC +2 resolver and from there it goes to the Route 53 resolver. And then depending upon the domain that you are trying to access, it will either query the public or private hosted zones on AWS. Or it will uh check the VPC DNS names or it will if the domain is an external domain, it will go out to the public DNS. Now, even though you have AWS network firewall which is blocking the traffic, this DNS query still goes out of your VPCs to get resolved. So once it gets back the IP address, the instance communicates to that particular domain via the internet gateway. And let's say if you have an AWS network firewall which is blocking traffic, and let's say you have rules to block example.XYZ, then that traffic will get blocked. However, what about the DNS resolution? Network firewall cannot block the DNS queries. This is where Route 53 DNS firewall comes into picture and it allows you to monitor, allow, or block DNS domain names and provides an essential control even before the connection is established. So unlike network firewall which can inspect network packets, DNS firewall is more domain aware and so you can essentially put DNS firewall rules blocking, let's say in this case example. XYZ and. It will make sure that, you know, that query gets blocked. So when you make a query to example.xyz, it reaches the route 53 resolver, but then the DNS firewall rules will block it and the query, uh, it will not resolve to a particular IP address. So these queries can be logged to Amazon Cloudwatch, and you can look at whether a particular query is blocked or allowed and so on. So in essence, Route 53 resolver DNS firewall is a fully managed, highly available service that integrates natively with the Route 53 resolver, and it gives you a way to centrally manage or create block lists so block DNS queries to malicious domains. You can create allow lists to trusted domains, and then you can also create your own custom rules or use some of the AWS provided rules for, you know, threat intelligence domain list which you can subscribe to. Thanks to the partnership with guard duty and uh recorded future, which and these rules basically help you to protect against malware, botnet, command and control, and so on. Again, here you can, you know, have additional visibility because DNS Firewall integrates natively with Cloudwatch, Amazon S3, and Kinesis. Now we looked at how DNS firewall can be applied to a single VPC. However, your workloads are not restricted to a single VPC. They normally get distributed across different VPCs. Now the DNS firewall is built for that level of scale, so you can apply the same firewall rule groups to all the VPCs in your account and thereby, you know, avoiding any duplicate logic or management effort to apply them consistently across your VPC architecture. Now the other capability that is present in Route 53 is Route 53 profiles. So profiles essentially allows you to apply and manage DNS related configurations consistently across VPCs and also across accounts. So here you can associate that particular profile to the VPCs and let's say if you made firewall rule groups as part of that profile. Any change that you make to that firewall rules get propagated to all those VPCs that are associated with that profile. Now, let's say you put the DNS firewall in place and you have enabled logging, you can use Amazon Cloudwatch to monitor your DNS query activity in near real time. So here is where you can look at, you know, which domain name was being accessed, whether it was allowed or blocked, and so on. So this gives your security team actionable insights. Are my rules working as expected? Are there new domain names which are showing up which needs to be blocked? or is there any suspicious activity that is happening in specific accounts or VPCs? All right, so we looked at several different options of uh of firewalling traffic on the AWS environment, and essentially this table gives you a view of all those options and what capabilities they provide. I'm not going to go through all of this. Uh, this is just to give you a picture of how AWS's options to inspect traffic at different layers. So from application layer to layer 3, layer 4, and then also the DNS traffic. And the idea is not to use one over the other. Instead use them in conjunction at different points of your architecture to build a strong defense in depth strategy for your environment. So how does it look in practice? So we started with a single VPC architecture, but oftentimes your workloads will evolve. You will have multiple VPCs. You may have workloads in private VPCs as seen here, but you may also have public facing end points with uh with something like an ingress VPC with connectivity to the internet via internet gateway. And then you can put the same control, uh, security controls like security groups, network ACS, and then also use AWS Private Link, which we talked about to connect to AWS services and private link enabled services. And then also use AWS web for your HTTPS based applications. Now these workloads will also interconnect with each other. That's where you build a hub and spoke model using AWS Transit gateway and then extend that to use a centralized egress pattern which Amish was talking about. Here now your private workloads can have access to the internet to connect to third party services on the internet as well as for security updates and so on. Now you can add those traffic inspection capabilities both at the ingress points in your ingress VPC or as well as your centralized egress using AWS network firewall. And then you can add that complimentary additional layer of protection using DNS firewall to protect against malicious domains. Now again, this doesn't have to be restricted to a single account. You can actually take that architecture in your multi-count strategy as well. So when you use a multi-count approach, one of the best practice is to use a centralized networking account where you can host your central networking and security resources such as centralized egress plus inspection, VPC AWS Transit gateway, and have an ability to interconnect networks across accounts. The way you do that by using AWS Resource Access Manager, which allows you to share resources across accounts and have an ability to interconnect all these networks. In your management account you can also create service control policy which allows you to control access to all these network security controls and provide that only to your trusted network security admins and not give access to your application teams so that they don't inadvertently circumvent any organizational security requirements. And then finally in this multi-count setup, you can also use 53 profiles and centralize your DNS firewall rule groups. Now you can apply that to VPCs in that networking account, but then also share those to other accounts and then apply them to your other VPCs in those accounts. So, as you can see here, you know, your environment evolves, it, it grows uh into multi VPC multi-count architecture with different security controls. And there are some considerations which come into play with respect to the observability. So let's look at those. So as your environment expands, one of the things that you need to look at is from a perspective of traffic visibility. Are you able to get those insights from a security standpoint by looking at your network traffic? The other thing is, are there connectivity paths within your environment which may not be intended as per your security requirements, and are the connectivity paths which are supposed to work working as required? And the third point is with respect to the governance. With so many security controls that you put across your accounts, how can I govern them in a centralized place? This is where 3 services come into play, which can help in those considerations. VPC flow locks, which allows you to provide that traffic visibility. Reachability analyzer, which allows you to perform that connectivity validation, and then AWS firewall manager, which allows you to govern all those security controls. So let's dive into each of these. All right, so VPC flow logs is a feature that enables you to capture information about the IP traffic that is flowing to and from network interfaces within your VPC. Again, this provides you information about, you know, various traffic flowing from between subnets of your VPC or between the VPCs uh itself using VPC pairing connections or transit gateway, or if traffic is going out on the internet. Now some customers also use it for cost show back. So let's say if there is a centralized networking team which is owning the transit gateway, and then it has to allocate cost to different application teams which needs to, which needs to plumb traffic through that centralized transit gateway. And then in addition, BPC flow logs can really help you in terms of planning, understand historical, uh, traffic patterns, and then forecast usage. And then from a compliance standpoint, you can archive all these logs for regulatory requirements and for ad hoc analysis. So let's understand this with an example, right? So let's say an instance is trying to communicate to a destination on the internet. And as uh via the net gateway. And so as traffic flows through your network, BPC flow logs can provide meaningful information about the source address, destination address, protocol, port, interface ID. And then as you can see, the destination address is that of the net gateway. Now you can enable additional custom metadata fields in your VPC flow logs, such as packet source address, packet destination address. And in this case, the packet destination address will point to the final destination where the traffic is going to. So depending upon the granularity of your use case, you can enable these custom metadata feeds. So VPC flow logs can be enabled at multiple levels. First of all, you can enable it at the VPC level. If you are focusing on specific resources in the subnet, you can do that at a subnet level, and then you can go really granular and apply that at the network interface level. You can also capture transit gateway logs into VPC flow logs, and there is an in-built integration of elastic container service which provides some additional ECS metadata into VPC flow logs. Now these locks can be pushed to 3 destinations. Amazon Cloudwatch being one of them, Data firehose, and Amazon S3. And the choice will depend upon the application or the use case that you are trying to achieve. So let's say if you want to do just uh archive logs for regulatory requirements or ad hoc analysis, Amazon S3 might be the choice. If you are thinking of monitoring these logs regularly in near real time and set up alarms and so on. Then you can use Amazon Cloudwatch and then you can also stream this to Da fire hose and then integrate that with several other analytics tools. So here, Amazon Quick site is one of the BI tools which you can use for visualization and dashboarding uh for these logs, or you can use Amazon Athena for ad hoc query. And then finally you can also integrate with some third party partner solutions for advanced log analytics with some pre-built solutions. All right, so the other thing you can do with cloudwatch is use cloudwatch contributor insights to gain security visibility. Now Cloudwatch contributor Insights has some rules which you can look at and you can target the specific log groups and display the top end contributors for a given log field or a combination of log fields. So you can look at things like, uh, you know, top end contributors based on the amount of data transferred or blocked requests and so on. And you can add filters to these rules. So in this example here, there's a custom rule which looks at the source address and action for a destination port of 1022, and this way you can track the top SSH connections that are happening within your environment. Another example is looking at accepted versus rejected TCP connections. So here, if you identify that there is an increase in the rejected TCP connections, it might be indicative of a brute force attack that might be happening in your apps, and you can investigate further. So essentially you can take this and customize it to your requirements and build a dashboard of these rules depending upon what is most important for your security posture. So you have the flexibility to add some built-in rules like top HTTP packets by destination address or use custom rules like rejected requests on port 22, which we talked about and so on. All right, let's, now that we talked about traffic visibility, let's move to that other challenge of, you know, connectivity validation. So reachability analyzer is a configuration tool that enables you to perform connectivity testing between the source and destination resource in your VPCs. And you can also use it as a configuration, intent verification and automated validation. So essentially, you may have network paths which are between subnets of a VPC paths which are going to the internet or between VPCs and you can identify if those paths are intended or unintended and see which, if they are working correctly or not. So when you run this analysis, you get hop by hop information of of uh of that connectivity between the source and destination and it can also pinpoint to the exact problem of why a connectivity is not working. So in this example here, an instance is connecting to the internet, but it's not able to because VPC block public access feature is enabled and that's what is contributing to it. Now reachability analyzer also supports network firewall. So what that means is when you have these hob by hob details of the virtual network path between the source and the destination, you can actually look at the firewall rules that got applied in that connectivity path. So let's say you may have an inspection VPC in the middle of that path with the network firewall. Now you can look at those firewall rules that got applied, troubleshoot them and make sure that they are working as expected, and there are no unintended consequences because of the security controls you put in place. All right, coming to the final part of, you know, governance and how you can govern all those security controls spread across your environment. AWS firewall Manager is that key service which provides you or enables you to uh security administrators to centrally configure and manage these firewall policies across accounts and for your applications across the organization. So there are 3 key things to keep in mind. First of all, firewall Manager integrates with AWS organizations, so allows you to centrally create and deploy these firewall rules across your accounts. You can configure a baseline of security policies, so essentially rules for your VAF, DDoS protection, security groups or network or DNS firewall rules and apply them across all your accounts in a consistent manner. And as your environment evolves, it can discover new resources. So let's say new accounts get created, new resources get deployed. It will discover those and then you can ensure that they are compliant with the mandatory rules that you have set up for your organization. So now firewall manager actually works with all the security controls that we have been talking about, be it, you know, the security groups, uh, your network firewall, DNS firewall, AWSAF, and so on. It also integrates with some of the third party security products as well as our advanced DDoS protection service, which is AWS Shield Advanced. And when it collects all this information, it has the capability to send notifications to a centralized security service, which is AWS Security hub. And the security hub can actually capture all that information and provide you a single pane of glass for your security posture. All right, so we talked about several different components. We talked about how this, your architecture evolves in from a single VPC into a multi VPC and a multi-count architecture and how you can apply those security controls for securing our disparate workloads. Now you can add those observability components to it. So here is where as part of the multi-count strategy best practice, you can create a security account and a log archive account and then have your VPC flow logs actually captured from all your VPCs and then sent centrally to a central VPC flow logs bucket. From here, the security admin can actually have access to this flow logs bucket and perform that security analysis. The other thing that you can do is. You know, in in this particular architecture you'll also see that your connectivity paths are crossing VPC and account boundaries. So now you can do the VPC reachability analysis across your multico structure so you can enable trusted access in the management account and then have your VPC reachability analyzer be part of, you know, that central networking account and perform that connectivity uh validation across across your accounts. And then finally, uh, with all the security controls that you have put in place, now you can govern them by deploying your firewall manager in that security account and having that governance capability for managing and having that visibility for your security controls. So as you see, we applied the defense in depth approach to our evolving architecture, then added those observability components, making it easy for you to build security at scale. And this is how you can achieve that defense in depth approach and build a strong security posture for your environment. So that brings us to the end of this session. Uh, I hope you learned a handful lot through this, uh, through what we shared here. There are some resources or some sessions at reinforce which are happening tomorrow on a similar topic. So if you are interested to dive deeper, I would strongly encourage you to attend these. And with that, uh, thanks a lot for your time. uh, thanks for coming here, and then, uh, uh, please, uh, fill out the session survey. We do definitely value your feedbacks. Thanks a lot.
