# AWS re:Inforce 2025 - Sticky situations: Building advanced AWS WAF honeypots for better security

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=2mlQL2cQfDY)

## Video Information
- **Author:** AWS Events
- **Duration:** 57.9 minutes
- **Word Count:** 8,410 words
- **Publish Date:** 20250618
- **Video ID:** 2mlQL2cQfDY

## Summary
This presentation focused on building advanced AWS WAF honeypots for enhanced security monitoring and threat detection. The speakers, Manuel Pata and Harith Gaddamanugu, discussed how honeypots serve as decoy systems to trap and monitor malicious actors while gathering valuable threat intelligence without increasing risk to production systems.
The presentation highlighted AWS's internal honeypot system called Madpot, which processes approximately 750 million potential daily threats, with 400 million evolving into actual malicious activities. This system has helped identify major security threats and nation-state actors, enabling AWS to push proactive mitigations before threats become widely known.

## Key Points
- Honeypots serve three main purposes: detecting attackers, wasting attacker resources, and gathering intelligence about new attack patterns
- AWS's Madpot system monitors hundreds of millions of potential threats daily and shares intelligence with government agencies worldwide
- Threat intelligence gathered from honeypots is integrated into various AWS security services like AWS WAF, Network Firewall, and GuardDuty
- Proactive threat detection through honeypots has allowed AWS to implement mitigations before attacks become widespread
- The solution presented is cost-effective and can be safely implemented by customers in their own AWS environments

## Technical Details
- Madpot: AWS's internal honeypot system that monitors TCP and UDP ports across AWS IP ranges
- Service Emulation: Honeypots emulate various services including PostgreSQL, RDP, and web applications
- AWS WAF IP Managed Rule Sets: Incorporate threat intelligence gathered from honeypot systems
- AWS Network Firewall: Receives threat intelligence data for enhanced protection
- AWS GuardDuty: Utilizes honeypot-gathered threat data for improved detection capabilities
- TCP/UDP Port Monitoring: Honeypots listen on multiple ports to detect various types of attacks
- Low-cost Implementation: Solution designed to be implemented without significant AWS infrastructure costs

## Full Transcript

So this is uh a code. Welcome to NIS 342. Sticky situations, right? So we are going to talk about uh honey or honeypots. My name is Manuel Pata and here with me is Harith. Hi Harith. Hey everyone, my name is Harith Gaddamanugu. Nice to meet you all. So the agenda for today, uh, from, from the audience here who has already been at the cold talk today or in a a previous event? Oh nice. OK. So in this talk, we'll be uh walking you through a a solution. It's possible for you to follow along on your laptop if you want, or you can just watch it, watch it as you prefer. I think it's a bit more funny to to get like ends on the solution will not generate uh uh cost lots of costs in your, in your account so you can safely uh run it. So it's up to you if you. Want to follow along all the resources are available to you or if you just want to to to watch us build it here on stage. We'll start starting by doing an introduction to Honeypots. What are honeypots and why would one want to to to build a solution like this. Then we'll go into uh the results that Honeypots brings to us, so observing uh the, the results from those uh Honeypots and also adapting our infrastructure. Uh, to, to our findings and last but not least, of course, is an ask for you to go and build your own, uh, solutions. I hope that you enjoy and um if you have any questions, just, uh, uh, raise your hand or come and talk with us after this uh this presentation. We'll be around after the court talk if you have any questions, um, you know, feel free to stop us, OK. Let's go, let's get started then. So, what are honeypots? Um, who has worked with honeypots in the past? That's a good number. Nice. So, and honeypots can be described as uh decoy systems, right? So a way to uh decoy uh malicious actor. A trap. Uh, solution to get them busy and uh stuck in a place where it will take them uh uh nowhere and most importantly those uh honey pods are intelligence gathering tools so you are using these decoy systems or these straps also to learn more about what's going on. Either overall on the internet or for threats specific to your infrastructure, someone that is targeting your organization and the goal of using Honeypots, of course we have like lots of data available from our publicly exposed infrastructure, but the goal of honeypots is to achieve this without increasing the risk without exposing our production systems more uh to malicious actors, so do it in a safe way. So we covered like from a very high level what our honeypots and uh most of the audience is already familiar with it like now we are going to ask you like why, why would one. Want to have honeypots in their infrastructure on their account and expose them and well, as I mentioned before, the main goal is to detect uh attackers so detect the malicious actors targeting your organization or specific obligations that you might uh might have um. Who is familiar like with star beating? Uh, or like gray listing. Uh, it's a, it's a mechanism to waste attackers' resources. So you know that you are exposing a dummy resource on the internet and you want the attackers to spend time there and slow them as much as possible. For example, in the past with my servers with the SMTP protocol. Uh, common strategy was to like provide like a very, very low response rates to the commands that uh spammers sent, so they'll spend like a connection, a TCP connection like open for a very long time and CPU time just sending like character by character each uh each second. So while they are doing that they are not spending their time elsewhere. Of course, with the growth of uh uh cloud computing, the attackers also have more resources available, so the effectiveness of this is no longer as big as it was in the, in the past. And if this is a domain that interests you, honeypots are also very useful to learn about new attack patterns. So not only the things that you already know, but new things that are being tried out um uh in the wild. And overall, as I mentioned before, you use this as a mechanism to improve your security posture, taking into account like not increasing the risk um for your organization. OK, so I've mentioned the, the what and the why. Um, I think you might also be curious on how AWS is doing this. So is how AWS is using honeypots to gather threat intelligence, and I think I will assist us with that, yeah. Yes, so just like you, uh, Amazon and AWS also are interested in building honeypots, and there are several teams within AWS Security that help make the cloud a secure place for companies, governments, and, and the whole internet. Uh, one such team is a threat research team. Uh, what this team believes is the best defense is offense, and they provide verifiable and actionable data to several internal teams within Amazon. The way they do it is using a service, internal service called Madpot. Uh, this has been around internally for a while, but this was publicly disclosed last year. Um, with a large cloud, uh, network footprint like AWS, we see a large, uh, amount of network activity happening, uh, internally all the time. So one of our engineers from the threat research team, they started an experiment of networks, you know, embedding some network sensors within this AWS IP ranges. For uh that acted like honey pots and decoys, uh, so. And this is, this moniker is basically madpod, and this it's like a lot of data. It's, it's a threat, uh, intelligence gathering tool that is evolving over the years and helping, uh, with AWS strategy for making cloud a secure place for everyone. So this network of sensors observes about 750 million potential daily threats every single day, and these threats evolve like out of 400 million of them evolve, uh, to actual malicious activities so our team internally ingest all this massive. Petabytes of data and tries to work with uh I mean various organizations like um. Like several three letter agencies within the US government, the Australian government, the UK government, and things like that, and actively works on some takedown, uh, activities. Uh, some of the popular ones are like, uh, World Typhoon. um, this one is actually a nation-based state actor. What they did is like they they planted some US, uh, like they, they planted some spyware and some of the US critical infrastructure. So our team was able to provide signatures, work and provide thread intel uh with the with the several agencies and try to identify them. Likewise, uh, sandworm is one that's a Russian group of hackers which, uh, Arre Tintel was able to identify and With this threat data, there are several times where even before these attacks become popular, there was this one popular attack that we spoke about that last year reinvent. It's a VPN based brute forcing attack that was picked up by Cisco and ACTA in 2024 May, uh sorry, April. But this team already pushed uh the required mitigations for that the pre like 20 days before it was discovered in the wild. So this is like this network kind of helps us gather the threat intel which becomes like actionable data and helps us push mitigations before they evolve into serious threats. Uh, how do we push this data out? Um, so we push this to we decimate all this threat intel into AWS services. The way we do it is, uh, these tens and thousands of decoys are listening on several TCP and UDP ports. They gather all this threat intel, uh, they emulate several services like they listen on postgrads, RDP. Web applications and uh make it attractive like we kind of the team kind of learns what is working and what is not and makes like attractive honey pots and collect all the thread data uh the with the intention of learning the techniques, tactics and procedures involved in various scans, probes or several CVs, and these threaten until today, uh, are being used by the AWSAF team. As an IP managed rule set that you could deploy uh by network firewall team as an IP manage rule set, guard duty uh uses this threat data along with several other sources within AWS to keep the, uh, to identify some of the attack patterns that happen proactively. And finally Shieldvan use this at the edge and the border networks to protect this from massive IPDOS uh activities that happen. OK, so this is one example of an enterprise grade honeypot that is being used at scale and you know that's being used by uh AWS so that we kind of transfer all this data to our customers and you know in the intentions of shared security responsibility model. While, while the threatened research team and AWS security teams, you know, work all the time to help customers, but there are some use cases where like US customers, uh, would still need to build some honey pots and um. So what are we gonna build and how are we gonna do it, uh, manual? OK. So, uh, it's time to start, uh, to start building. Let me go over the overall architecture that we are going to, to build, uh, today. So We'll be using AWSWF as the, the name of this session implies, of course. Waf will be integrated with the cloud front distribution. Cloud front distribution will serve a web application. It's like an example web application, you'll be able to download it and deploy. It's deployed to an S3 bucket as like a static static website, and we leverage several capacities both from AWSF and the compute capacities from cloud front to implement the honeypots. If we still have time, we'll also implement another mechanism with API gateway and Lambda. To collect additional information, so this architecture ideally is published or is deployed in an isolated AWS account, right? So you don't want to to have your sandbox, your playgrounds that your attackers will be exploring, sharing the same accounts as important workloads that have access to your own network. So try to isolate it as much as possible. Nevertheless, we'll share an example where you can use these kinds of capabilities from MAF to implement um a decoy system in in production, but this is the starting point. So why cloud front and estuary. The cost is low of serving this application of having this um of having this honeypot available on the internet and the risk is very low. So you don't have any custom code from you being executed in this path. There's very little code from you apart from the lambda attached function that's integrated with uh with Cloudfront or the cloud front function that will also be um running so. Uh, open up your AWS account if you want to, to follow along, or if you just want to, to watch, I'll use my, my own AWS, um, AWS account, OK? So, let's get started then. And there are different types of honey pots, right? I think there are low, medium high interaction honeypots. There are different intentions. What do you want to do? Do you wanna get the threat intel? Do you wanna make it so like a decoy? Uh, do you wanna fake something? Are you solving a specific problem? So the architecture is kind of similar. That's where we are going for, like we're going for the model, but you can take all these learnings and and use it for your use case. OK, thank you. So, um, have you opened the PRW accounts? By the way, is anyone who's not able to read what's on the screen? Raise your hands. You can read it? OK, good. Thank you. Let's get started then. I can also read it, I think. So we'll start by, uh, creating, um, uh, an estuary bucket that will host our application. So go to the estuary console. And by the way, we'll try to follow all the best practices when setting up a cloud front with an estuary buckets. So here I already have a nestuary bucket which is called uh Bigganipod cloud front, but you'll go ahead and create your own. It has to have like a distinct name from this one. And then head out to resources. big honeypot.com, OK? And there Oh, I need to increase the, the font size. OK, so at resources. big honeypot.com, you'll be able to download the sample application. OK, so. What I'll do is just copy the link and I'll use cloudshell so you don't need to use it, like download it to your own um uh computer, OK? So we came here to our 3 buckets and we'll use cloudshell to deploy it. Everyone is familiar with Quho, very useful tool to, to run these kinds of demos or even to run some tests on your um on your accounts. OK, so let's download it so that we can deploy the resources to to the S3 buckets. OK. You you'll need to copy the bucket name. Um, where is it? It's big pots. And we'll do a thing, right? Oh, We always forget something in the demos. OK, so. I have my bucket populated with my sample application. Now I'll go and create the cloud front distribution. Everyone familiar with Cloudfront and the integration. OK, let's go. Go ahead and create a distribution. For the origin, we'll use the S3 bucket that you've created. We don't want the bucket to be publicly accessible. So nowadays with Cloudfront you never need the bucket to be publicly accessible. You can use Origin Access Control or the Legacy Origin access identities to make your bucket private. And it's the same also. For resources that uh you have on your VPC, so you can use VPC origins and you don't need to expose your ALB or or your NLB to the internet, OK, so you can have them uh uh private and Cloud front will still be able to connect uh to it. So Rin access control, let's create a new Rin Access control, sign all the requests, oh. Already exists good. So, uh, 342 session. OK, we'll need to update the bucket policy. So this is an iPod, but we still want to make it safe, so we'll, uh, force users to be redirected from HTP to HTTPS. Um, we will just allow the get add and options methods. We will, um, use the cash policy caching optimized so there's like no dynamic content here on the S3 buckets and for the time being, uh, that's it. So we go into the web application firewall part. We will enable security protection. And set it in monitor mode. What does this mean? It means that when I create this cloud front distribution with AW West attached to it, it will be already created with Awa Web ACL there and with some rule groups in count mode. We don't want to block anything, so we want the traffic to still flow in, and we want to gather intelligence from from that. We use all edge locations. We don't have any SSL certificate for the time being, and we just want to set the default root object to index. HTML so that when you load your cloud from distribution, you will see uh the landing page of the application. So. Let's call it demo. OK. So we are still setting up the infrastructure. There's one more step that we need to perform. And that is, well, actually two steps. So the first one is to configure the bucket to use the origin access um identity, right? So when you go here to your origin, you click edit. And you will be able to copy a policy, a bucket policy to be applied to your S3 buckets. Right, so I'll come here. I'll click. Uh, bucket policy edits and I apply my bucket policy. OK, so once I do this, only this specific cloud front distribution will be able to reach my S3 buckets. OK, so let's go, let's save it. And now the next step that we need to perform is to enable logging on this web application firewall that we've created. The logging will be useful when we want to gather insights from our uh honeypots. OK, so let's go to my distribution to the security tab. And you'll see that I have some car protections um enabled. I'll go to the Web ACL. And I will configure logging. So logging is disabled at the moment and I will enable logging. Any log destination that you create for AWSWF has to be prefixed by AWSwa logs something that you that you enter. Otherwise it will not show up here in the drop down and even if you are doing this in infrastructure as code, it will not perform the integration. So it always needs to be prefixed with AWSWA logs. So I'd already pre-created a destination on cloudwatch logs. This is the easiest way to create the logs, like uh in a live demo uh like this, but you also have other possible destinations like S3 or uh firehose. OK, let's save. So Our infrastructure is um is ready, right? So let's try out and see if the clouds front distribution has propagated and if there's something for me to see here or if I forgot about something because this is a live demo, right? OK, there we go. It's working. OK, so here I have my e-commerce website, uh, it's looking good, uh, is looking very AI, I guess, um. So yeah, I don't know how I did this, but um, well, it's working. So I have this application, it's a simulation, right? So you don't want to put real production data. You might want to put data that's aligned with your business, like some kind like to get like targeted attacks. So if it's e-commerce, you go for e-commerce. If it's like if you have a sales, you try to build like something similar to toes, not exactly like you have in production, but something. That you want to target like to to catch attackers that are targeting your um industry. I, I happened to open uh to, to work for a company that has like a very famous retail store online, so I did like an e-commerce um website. OK, so here it is, it's working. Um, I have a web ACL configured and I'll start building my OPods. I think that's why you are, uh, here today. So Go to your web ACL and let's take a look at the rules that you already have there in place. So IP reputation, it's very useful. So, um, there are other sessions here at Reinforce, um, that that will cover, uh, this in too detail, but the, the baseline for the, the web ACL created by Cloud Front includes IP reputation, the common rule set that that catches, uh, uh, common stuff like servers side request forgery, for example. And no bad inputs, but we'll add another one because uh well we are doing a demo and we need something interesting and easy to test, right? So right now we have like an isolated account, a static web application, uh, that kind of looks to be dynamic if someone looks at it, but all the traffic that's coming here, it is like there's no SEO so we are not, uh, publishing this anywhere. So everything that comes here, we already know that might be shady, like might be a scanner or something, and they'll be trying things out and I will use one of the three rule groups. Uh, for, for the the honeypot with waff, which is the SQL injection rule group. I will edit here and override everything to count, right? I don't want to block them. I don't want to scare my attackers away. I want them to think that something, uh, that they are that they are being successful. So I had this rule, it can be at the end of my, my rule set, it's OK. And safe So everything is count, nothing is being blocked. Attackers are going to my website and they are trying things out. So, how can I like start to, to, to deploy some, some decoys to, to try to cheat them? OK. Let's go and write the custom rule. So we'll add a custom rule for our uh web ACL and this custom rule will be used to capture this kind of request. So I'll start by the one from uh SQL injection. I'll check Because I already have the SQL injection rule group, the request, once it's processed and if it is a match with the SQL injection rule group, will emit a label. A label is just metadata while the request is being evaluated by WSWA. And I will use this label for my honeypot. So, if the request has a label, Of SQL injection in the query argument, so in the query string. What I want to do is still count, still, still let the request through. But I'll do something. I'll add a new customed to this request. And I will call this a tech type. And I say that the value of this error is SQL injection query string. Ed When I'm using labels, the annuly requirement is that this rule comes after the one that labeled it, right? So, it is after the SQL injection rule set, so I didn't, don't need to, to change the priority. OK. It's working. So, apart from information in the logs and a new adder in the request, what can I do with this? So, how can I actually build um the unadd? I'll show you two different ways to achieve this. The first one is using a cloud front with lambda at edge. So lambda, you know, the server functions, and Lambda TE is the Lambda service integrated with Cloudfront, with your cloud front distribution. So Lambda will be able to inspect the request in different trigger points. So on viewer request when it's arriving to cloud front, on origin request, so if it's not cached when it's going to the origin, and then on the way back, origin response and viewer response. We'll be using. Um, a viewer request integration, right? So what processes the request and now our land executes, right? So how will I call it? Honeypots at edge. For this code talk, I will use Python as the runtime. And for the execution role, I will use, uh, I need to create a specific one for Lambda edge because Lambda Edge has some requirements regarding propagating this lambda function to the different regional edge caches from cloud front so it requires some additional permission. So, um, on demo at edge. I have a template already for this like it's in all, uh, it's already part of the, the lambda console and it's basic lambda attached permissions. So don't forget to tick this whenever you are creating a new lambda attached um function. So create function. Let's go. Let's do it. So, uh, now we wait a bit because it's being, uh, uh, created. And what am I going to do with this? OK, so first of all, um, yeah, I might need Jason. We'll see. So what I'm going to do is I'll look into the cloud front event that's, uh, uh, received by Lambda. So I go to the event records cloud front, and Amazon Q is helping me here also, not only with the, the static website. I just want to look at the request, OK, so I'm uh selecting the, the request key. And now I want to check if Xs Amazonwa attack type one thing to add the other is present in the requests. OK, nice. Amazon Q is working. OK, so I don't want to block this. What I want to do is check the add value and check if it's a SQL injection. Right? So in this case, the other value is SQL injection in the query string. By the way, can you, can you read it? It's readable from there? OK, good. So we are not going to block this request, right, so we want to allow it. It's OK. But now, let's pretend. That they were actually successful. OK, so admin password 123 hashtag no one uses this password, right? So it's the first time you're seeing something like this. So, um. The land attached will now return the, the this response, right? So let's deploy it and see what happens. Let's see if I didn't do any, any mistake. OK, so deploy the function. One thing when you are working with Land at Edge for developing your honeypot or any other situation, make sure that you have some test events available because the published process is not immediate uh when you are publishing to the edge. It's easier to test it here than test it like in line with um with Cloudfront. OK. So I can prepared hopefully. Uh, there are also like test events from Blueprint, yeah. One of the things that it's very useful to have is the documentation available. And make sure that it opens. So let's grab a random viewer request event from the documentation. And test our function before deploying it to to to close front. OK. Oh, succeeded. I think it's good. I will not uh uh go any further. So now what I need to do is deploy this function to my cloud front distribution. So I'll deploy it to land attach. It's a nice section. So this is my cloud front distribution for this demo. The cache be over is just one wildcards, and I'll use it on viewer request. OK, confirm the deployment to lambda at the edge. OK, so what did we do so far as in the way of deploying like uh an honeypot? So I'm using AWS SWAF to gather intelligence on the request. So use the non-vulnerabilities from Middle SWA. I'm not discovering something new. I'm not learning new attack patterns. I'm learning about existing attack patterns, and I'm reaching the request with that information from Middlewa SWA to then. Implement the kind of decoy that I want to implement. It can be I can log it like for example for a Dynamo DB table or I can send it to a data stream or I can return a response that makes my attacker believe that they are actually being successful. So I'm deploying like a fake system for for them. Of course in this demo it is very simplistic, but you can evolve it further. OK, so let's, uh, I don't know if it's uh deployed yet, but we can check it out. So we are going to test our SQL injection pattern. So if you scroll down, You'll go and see there's this sequel injection pattern. Um, oh. It's working now, so my edge is deployed. So whenever I triggerwaf in some way with the equal injection attack. I get this response back, right? So and in this case it's just like uh a common very common username and a very common uh uh password so you can implement this for other kinds of attacks, for example, you can do. Instead of SQL injection, you can do this for uh server side request forgery. For example, if they are trying to capture your uh instance meta data, if you haven't updated to IMDSV2, you can use this to to capture it, for example, uh, again. I'll check for a label, the presence of a label. server side request forgery. I'll also use the query string. It's easier for me to test, right? So I'm not counting. I'm just injecting a newer, OK, a tech type and the value here will be CQ, uh, server side request forgery in the query string. Only requirement it's after the common rule set, which is the one that detects server side request forgery. Let's save it and we can edit our function. OK, so let's go to codes, update codes. So in order to like not to be um very repetitive, I just got here. A spoiler, so if you go to the resources page. There's like hidden hidden links with some spoilers for the lambda functions that you are going to see here today. OK, so What did I do? I'm, I have a condition for server side request forgery, and I'm returning kind of like instance metadata credentials, but this is dumb like this is not really uh a key, it's just um uh dummy. Right? So I don't know if you've seen already, but some, uh some threat intelligence, uh, companies, they actually provide valid credentials and then they analyze the cultural logs for people trying to use those credentials even if they have no policy, uh, attached so they cannot perform any action. This is risky, uh, so for this demo I'm just providing credentials that are invalid but they still make the the attacker believe that they were uh successful. So I deployed this and I need to update my trigger, right? So I'll go here and update it. OK, and it will take some time to uh uh to deploy. So for these 1st 2 honey pods for sequel injection and server side request forgery, we'll leverage AWSWF to, to capture known vulnerabilities. What about things that we don't know yet, and things that we don't know yet can be, for example, bots that are scraping. So we don't know the source of these bots and we want to to find out and they can be targeting your website, for example, if you are selling tickets, they can be like uh uh trying to purchase all the tickets that are available, or if you have a product listing they might be trying to to lower like their um their their own listings according to the price that you are setting. So how can we leveragewa to detect that? There are two distinct ways that you can approach this. Uh, one of them is through rate-based rules, for example, or, um, anonymous IP list. I, I will use the rate-based rule to check, uh, for, uh, clients that are doing too many requests, and you can specify, for example, too many requests to my um uh product listing page. So they are paginating it a lot. And you can do like infinite pages and see if they keep on clicking there, um, uh, forever. So I'll create a rate rule. And I'll set for the demo the minimum threshold possible, so 10 requests every 5 minutes. I'll use the source IP as the request aggregation and I can consider all requests or copy down to my product listing page. I'll do all requests, OK, again, I will not count, but I'll add an error and this time the attack type is um a scraper. OK. So, What will I achieve with this um with this one? So, in this one, I will not use lambda edge. I will use a cloud front function. So cloud front functions uh are executed at the, the points of presence, so at the edge locations. They are way faster, but they are limited in the capabilities. So while we landed edge, you can deploy your own libraries and write like a very complex honeypots. On cloud front functions, you are limited in the amount of of code that you can use and the libraries that you can use, and also the time of execution, and there's no um network access. So, but for this use case, you'll see that it will make sense. OK, so I'll use um a Clause front function. I'll call it scrapers. Uh And let's go. I also have a spoiler here, so I don't worry you writing um all the codes. What I'm going to do here. Is different from what I did before. So in the past I was returning like uh um as if the application uh was exploited. Now, what I'm going to do with this cloud front function is, if I detect like someone eating my web page too much, like my product listing page too much, what I'll do is serve them with a fake website. OK? And the fake website can be a fake product listing. And you can do this. If like if it makes sense from a business perspective, you can even do this on production. So unlike the previous honeypots, which you might not want to do them in your production website, if you have like a a false positive, you can provide like a bad experience to your users. Here, if you know very well your attackers, you can use this change of origin. As actually like uh a way to mitigate scrapers, so you are sending them to a different application server or to a static product list that has like the prices that you that you want and they are not retrieving any meaningful business um information from from you so you. I'm looking into this injected adder for a scraper, for the value of scraper, and I will select a new origin that's called uh fake website. So I think we need to deploy that. So, let's go to my cloud for a distribution. Actually, I first need to go to West Street. Right, so I'll create a fake uh bucket for my fake application. So let's create like honeypot, uh, big honey pot clot from fake all the same. I created and now. Let's go and uploads like the fake version. Because you only know that I have right now to demo like a fake application is to change the color of the page, that's what I will do, right? So. I'll go and change this to CC 66. I don't know what color is this. And again, let's sink it to. My new, uh, my new buckets, the fake buckets. So while it's sinking. I'll go and create a new origin. So if it will be like a production website, your main origin would be an application server and your fake would be like an S3 buckets, or it can be a distinct like uh um application pool as you prefer. So let's go for the fake one. Here it is. Urgen access control security is still important here. Um, we'll use the same origin access control. Create origin and last but not least. We need to change the bucket policy. Copy policy That buckets. Fake permissions and here we go. OK. Safe change. OK, so I'll be able to use this uh S3 buckets from Cloudfront. Let's publish mylofront function. So scrapers, it's unpublished yet. Let's publish it. And make sure that it's working. I need to associated with micron distribution. I use the demo distribution, viewer request also, and the default cache behavior. OK, so I'll need to wait a bit for propagation. Any questions so far? Anything that you want to, to ask? Good. Uh, kind of if you go a bit, uh. Yes, so the question is if there's any kind of automation to get information from uh the attacker and uh uh put it in a denial list, right? So there. I know for if you are familiar with, but there's like um an automation solution from AWSS which is called uh Security Automation, and I, I can share it in while this is propagating. Yeah, like the security automation template, what it does is it deploys a shadow API gateway endpoint which is backed by a lambda function, so you could hide this in your CSS code. When an attacker, not an attacker really, but a scraper, non-serious scraper, tries to load your JavaScript, they would end up clicking this API gateway endpoint. The lambda would fetch the IP and uh it would add it to the AWS uh VA IP list. You, you got it, yeah, just click on it. Yeah. So that's the one. Is it readable. Hopefully so, so that's one automation. So security automations for Waf uh does exactly, uh, that. So it it constantly collects looks at the logs from uh AWS SWF and implements, uh, uh, some mitigations based on the information that is there, OK, but this is something that you can use in your production systems, OK, safely. Yeah, any other questions, uh, while we wait? OK, so let's see if it's working, right? So I said 10 requests every 5 minutes. I'm curious to see what color it is. Yeah, we'll, we'll find out. So the red base rule is evaluating. So red-based rules work with a sliding window. It's evaluated like every 1015 seconds, so we might need to wait. 00, I have a mistake in my application, in my, uh, function. And I know what it is, so let's fix it, fix it very quickly. So the problem with testing this directly uh in production is that you can break it, of course, so. The origin name is this. And in my function, I use the different origin name. OK. Save changes and publish my change. So so far we've uh found like two different ways to leverage graph and the compute capabilities of cloud front to implement like honeypot like solutions with Lambach, very powerful. You can even, for example, for server side request forgery. You can even implement like uh uh a mock server for um the AC2 metadata and for cloud front functions you can use, for example, for origin selection. Let's see if it's working. Oh, it's orange. Oh it's orange. So yeah, yeah, so I'm a scraper. I've, uh, um, scroll. I've listed too many pages, uh, from my product list, and now I'm, I'm getting like a, a fake version of my, of my website. Um, why is this important though is if you are like, let's say Manuel, like he's the product owner for this website and he has a competitor. They constantly keep checking his website for pricing. He can actually do this and serve them fake pricing. Yeah, so, so that's one way to keep up with like somebody like if you are like a popular concert ticket reseller or somebody, if you want to just pull them up, like just give them like a 9 dessert or a 10 dessert price and. Yeah, so it's, um, yeah, so some of our customers are using this kind of capabilities um as a way to mitigate this, uh, scrapers, so they are not blocking because when you block, uh, the attacker will move to to the next level so it's it, it will, uh, become more difficult also for you to protect from it, but they serve slightly different information. And according to to a risk score. So you kind of use AWSWF to score the risk of this this request and serve the contents um accordingly. So I mentioned that there are different ways to implement this. And I also mentioned earlier in this presentation that the goal of this is to be like a low cost low risk uh uh solution. So from a risk perspective we haven't increase we have not increased our security, uh, uh, we haven't decreased our security posture so we haven't increased our risk so far from a cost perspective we are still using the free capabilities from AWSY, so we are just paying for request processing, but you can go further. OK, so with the SWA, you also have uh the managed rule groups for bot control and it's a situation where you can also deploy them. So if you are looking into AI bots, if you are looking for other kinds of uh of bots or non-human interaction, you can also use um the, the bot control uh uh rule groups, OK? So you have bot control. Uh, common and targeted, the stateless inspection of the request. We'll just look at the properties of the request and uh uh label those requests. Targeted will look, it's stateful. It will look into the whole session. It will check if it has like a valid token. Uh, you can use the the JavaScript SDK SDK integration like with your web app, so you get more data, but that's an expense of like, you'll pay. Uh, more for this, so it depends how much you are willing to invest in your honeypot solution. And we also have other capabilities on account creation fraud prevention and account takeover prevention. So these are uh more expensive, so this is something that you use uh when you want to bring additional business value, so not when you are trying to find out what's going on on the internet, so. What can we do here in our application as a like as a, a new honey pod strategy. So we have like a search bar and we have a log in and create accounts uh uh capability here. As you might imagine, this is all fake, so this will not do anything at all, but we can use other services to gather information from here. So are people trying like are attackers trying to enumerate logins? Are they trying to use compromised credentials? How can I do that without skyrocketing my uh my cost? So for this we'll be using um API gateway. We are a bit short on time, so I'll go quickly through it and then we'll go into the observability if that's OK. OK, so API gateway allows you to have an integration with uh with tolerated services. In this case, we'll again use lambda. We cannot use lambda at edge as it's limited in its capabilities to inspect the body. So we need to use API gateways, uh, API gateway for this. We'll create an HDP API. It's a demo. So, but just create it as simple as possible. And we'll create a lambda function. What this lambda function will do. I logging back end for the unipods. Again, I'll do Python. Nothing, so this is not one that edge. I don't need special permissions and again I will. Use the code that I already prepared for this. So, what will this code this uh do? So it will look into the path and the method that is being used, um, actually, I'm doing it for, for everything here, but we can limit it, for example, for the login end points. We'll look into the body, if it's base 64 encoded, it will decode it and just print it out. So we now have this information on uh cloud watch logs. So let's deploy it. And add an integration with API gateway. So let's use an existing API demo. Defaults no security. So it's open. And let's go. OK? So here we have our integration. Let's test it. The go to cloud fronts to our distribution. OK, here it is. Create a new origin. Whoops. That's it. I remove this, yeah. OK. So, creates. And I'll add a new behavior. Right, so, and for this, I just want for slash login. I'll use my API gateway. Still, security is our priority, so redirect HDP to HDPS. All allow multiple methods, caching disabled, and send all errors except the host error so that API gateway doesn't get confused. OK, so while Cloud Front is publishing. I will create like um. A default routes, I think I can do this to capture everything. Touch integration. OK. OK, deploy. Yeah Uh, LCD play, OK. So, um, If everything works, I should have your, like in my login and points away. Oh, sorry, not yet. Yeah, go ahead, go ahead. Uh, can you switch to, yeah, OK, so, uh, we'll just wrapping up like this, um, this integration. What we will have here is whenever someone tries to do a login and careful with the information that you collect here. You will get Uh uh. OK. Sorry OK. You'll get a log with information that was input and then you can automatically process these and check if it's compromised credentials and then uh look into uh blocking those uh requesters automatically, for example. So that's it from a demo perspective. We are now going into the observability parts. Uh, OK, so thank you, Manuel. That was not easy. You still managed to put in the API gateway in there. So, OK, so knowing your attackers or understanding the threat is only battle half won, like to actually understand and make this data more meaningful, you need to build some strong observability capabilities. Why? You need to, the focus of the observability has to be like these three things. Attackers and attackers and what are their safe havens like identify every business is different, right? Like that in this, uh, in today's world, if you go on to some of these Reddit and Telegram forums you would find specialized. OK, there is this particular website on e-commerce, then there are attackers and services that are meant for that. So you need to understand your target attacker audience too with your honeypot. So that's one focus of it. The other focus is understand the scope of these sans that are coming in. Did they go to your login page all the time? Do they go to their about us page? What is that is like what asset of your website is more interesting to the attackers? if you understand this, you could scope down your VA statements or like add in more security measures specific to that. Like that helps you understand the problem a little bit more and unusual behaviors and tactics. So this one is. What is the unknown, uh, you know, like everybody here, like, you know, we all spend a lot of money to understand the CVs, get them pushed on zero day. All that is great, but there is a lot of unknown that comes in and goes, something that is not meaningful for your application, something that is driving revenue, so that should be your focus. So these are with this focus, uh, in mind that you can build a lot of interesting observability solutions. Uh, I, I'm just gonna quickly share a link here. This is a centralized logging solution with open search. Um, if you scro if you take a picture of or scan this QR code, it will lead you to a solution that you could quickly deploy in 20 minutes. Uh, this will give you a nice interesting web dashboard with has a lot of data in it, but the idea is to focus and gain that understanding of who these attackers are. You could also natively do do this using AWSA console. Uh, manual, do we wanna quickly show them how the solution looks like? Yeah, yeah. So, yeah, so this is a dashboard, uh, that, that you're seeing that just deploys that. So geolocation is important. ASNs are important, like, you know, who are your top 10 ASNs, who are your top 10 GO and not so the interesting part is these are not your regular users like. Uh, you know, these are your honeypot users, so you treat them, uh, give them the same respect, build them the same sort of availability solutions because you want your honey pots to also look closer to your real solutions. So the observability part, uh, if you scroll down a little bit, like, you know, you'll understand which parts the users are going to like these honeypot users are going and, uh, again like buildAF rules. To make it easier for them, like, uh, so Manuel just showed us some examples of SQL injection, server side forgery, some bot detection, right? So if there is a particular, uh, dot NV file slash NV file, for some reason everybody is interested in that, create a wa rule in your honey pot to add that header and next time you would serve something for that. So it's a cycle, it's a cycle. So this is a part of it. Uh, can we go back to the louder? You could do something, uh, you could do something similar with cloud front logs as well. This one is also available in the centralized logging solution. You could also use our native cloud watch dashboards. You could use native cloud front dashboards, um, and in a day or two, we will be talking about more interesting solutions, uh, that are available publicly through some of the new launches that are being covered at reinforce. OK, that being said, that brings us to the end of the session. I'm gonna leave you all with some additional reading materials. The first one is a link to our application security performance portal that talks about different edge services in use. Um, if you're approaching them from a honeypot lens, there are some interesting links like what types of AWS manage rules are being used, what types of other lambda types and, uh, cloud and function capabilities that you could use. Uh, the second link is, uh, DA's resiliency best practices. We generally like to end, uh, and with that. And lastly, there is an, uh, the reinvent video which talks about the mad pot experiment and how the threat research team uses this, um, to capture this. OK. Uh, thank you. That brings us to the end of the session. We're still here if you have any questions. Um, thank you everyone for being here. Thank you.
