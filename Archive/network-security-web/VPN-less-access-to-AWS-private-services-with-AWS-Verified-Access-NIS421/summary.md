# AWS re:Inforce 2025 - VPN-less access to AWS private services with AWS Verified Access (NIS421)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=YsXaBUcVBvw)

## Video Information
- **Author:** AWS Events
- **Duration:** 17.9 minutes
- **Word Count:** 2,982 words
- **Publish Date:** 20250620
- **Video ID:** YsXaBUcVBvw

## Summary

This session demonstrates how AWS Verified Access (AVA) enables VPN-less, zero-trust access to AWS private services. The presenters explain how traditional VPN solutions create network pipes with limited granular control, while AVA provides application-level access control that evaluates trust on every request rather than just at connection time. The solution integrates with existing identity providers and supports browser-based or agent-based access from anywhere. Two practical use cases are demonstrated: accessing Amazon FSX for Windows File Server and Amazon OpenSearch Serverless through AVA endpoints. The architecture uses a connectivity client, trust providers (like IAM Identity Center), and per-application policies to ensure only authorized users can access specific resources based on continuously verified credentials and device posture.

## Key Points

- **Zero Trust Architecture**: AVA implements true zero trust by evaluating every request rather than establishing trusted network tunnels like traditional VPNs
- **VPN-less Access**: Eliminates need for client VPNs, site-to-site VPNs, or Direct Connect for accessing private AWS services
- **Per-Application Policies**: Each service gets its own AVA endpoint with granular, Layer 7 access control policies based on user attributes and device posture
- **Continuous Verification**: Unlike VPNs that authenticate once at connection, AVA verifies trust on every request to applications
- **Enhanced Observability**: Provides detailed logging of all access control decisions in CloudWatch, showing user information and policy evaluation results
- **Existing Identity Integration**: Works with traditional identity sources like Active Directory, IAM, LDAP, and multi-factor authentication providers
- **Device Mobility**: Enables workforce access from any device, anywhere, without VPN client compatibility requirements
- **Simplified Operations**: Consolidates complex network policies, firewalls, and IP-based controls into simple application-level policies

## Technical Details

- **FSX Integration**: Supports Amazon FSX for Windows File Server (Single AZ1 configuration only), requires Active Directory for user authentication, uses SMB protocol on port 445
- **OpenSearch Integration**: Connects to OpenSearch Serverless private endpoints through VPC endpoints, requires AWS Signature v4 for API authentication, uses HTTPS on port 443
- **Endpoint Configuration**: AVA endpoints support TCP protocol with network interface or CIDR range endpoint types, deployed in same VPC as target services
- **Policy Engine**: Cedar-based policies evaluate user attributes (email verification, domain membership) against trust provider assertions from IAM Identity Center
- **Connectivity Client**: Agent-based client handles authentication with trust providers and establishes secure connections to AVA instances
- **Network Requirements**: Security groups must allow traffic between AVA endpoints and target services, with proper VPC and subnet configuration
- **Authentication Flow**: User authenticates to trust provider → connects to AVA instance → accesses specific endpoint → reaches target service with policy evaluation at each step
- **Host Header Handling**: For OpenSearch, custom host headers required to properly route requests through AVA endpoint to the actual service endpoint
- **Access Logging**: Comprehensive audit trail in CloudWatch logs showing authorization decisions, user details, and policy evaluation results for compliance and troubleshooting

## Full Transcript

Morning. Good morning. Thank you all so much for being here. I have to admit it is rare that we see this many people out at a 9 a.m. something session the last day of reinforced, even some standing room only in the back. So everybody thank you all so much for being here. I'm Mike Hornstel. This is my colleague John Soul. We're both solutions architects here at Amazon, AWS, and we're here to talk to you about VPNless access to private services with AWS Verified access. Alright, so what's the need? What's the story behind verified access and why do we need it? Simplify connectivity, right? You all have corporate resources. You all are here right now, so I assume you do remote work. No one's able to tune out for 3 days. I wish we could. So what does that mean? Usually we either have VPNs, we have site to site VPNs from branch locations, we have client-based VPNs here, but those are network pipes, you know, that involves tunneling, split tunneling, forking network traffic, dealing with IP based policies, not just layer 7 based policies, right? What else? Maybe we also have direct connection just like I mentioned, full tunnel VPNs. Let's send all of our traffic one way and hope for the best upstream. But what about granular access control? What about something about policies perhaps an individual application as an individual flow that can be treated as zero trust with verified access? What about access from anywhere, browser based or agent based? Effectively we're saying zero trust, right? Not just a trusted VPN like system but a zero trustba architecture. So zero trust. When I say zero trust, be implementing zero trust today. Show of hands, hands zero trust. Nice, yeah, it's kind of a not just a buzzword but the way of operating right now and helps us get through a lot of audit and regulatory pain at the same time. So zero trust network access, it's a model that means we effectively don't trust anything, right? We don't just verify access. Once like a VPN where we say password or authentication based or er based off and then establish a tunnel we're always consistently verifying what is this flow, who is it from, and always giving uh verification so we use traditional identity sources like Active Directory, IEM, LDAP, any traditional source to maintain who identity is. We have a device or an endpoint. And we continuously verify what that flow to that source is, meaning we always use something like AWS verified access to take a look at the requests and evaluate trust on each request, right? So think of that as the opposite of a VPN on a VPN, a client VPN, we evaluate trust on connection, right? We evaluate trust by AAA on connection. We establish either identity, we've got a cert, we have our AAA. And then we rock and roll and we only reauthenticate or re-evaluate that trust when we disconnect and reconnect. Zero trust says for every request that we send, let's evaluate trust. Let's figure out who we are, what we are and what we're doing. And on top of that, We can take this to the next level by increasing your mobility, improving your posture, and also simplifying your operations, but what do we mean by that, right? Mobility when we can access anything from anywhere using zero trust and treating different flows in different ways for policy, which we'll talk about here in a little bit. We can take your workforce and distribute them where you need them to go, not based on a VPN client compatibility right? not based on a desktop endpoint security solution, right? We can put it on for every device you need to be on. At the same time we can improve our security posture because we're not just evaluating trust at one point we're evaluating trust on multiple requests and we can treat different requests with different policies and at the same time we simplify the security operations because what was a thing like VPNs, certificates, policy-based access, IP based policy, firewall policy, all those things goes away to just be a policy within an AVA endpoint. So what do you mean there? Let's take this example of securing access to some corporate applications. We take AWS verified access. We have a policy on a per application basis because each application is a different request, a different layer seven policy, a different flow so we can authenticate it and zero trust and treat it that way. We have per app policies that give us fine-grained access control with dynamic authorization, meaning again every request has that level of AAA to it. We improve our observability because we're not just saying for example in a VPN like world we're not saying well the pipes up we've got packets going through it no way with verified access we can say we have observability over every request, every flow for our policies at the application based level all layer 7. And we can use your existing security services like identity trust providers and uh and multi-factor authentication providers to integrate with Xero Trust and AWS verified access to get you where you need to go from your device and your endpoint to your application, no more and no less. So what this means is we first have verified access, we create and configure our trust provider, our group, our policy, and then for each private service we create an Ava endpoint, a verified access endpoint that gets us to the TCP protocol and the layer 7 application that we want, and we also have our connectivity client at the edge which allows us to connect to that, which my colleague John will tell you a little bit more about on how to access private services right? Thank you Mike and um I'm not dressed quite as cool as Mike, so sorry about that. You'll have to do with me. um I'm John Saul. I'm a social architect based out of Atlanta and I'll be going over how to access two services, um, FSX for Windows Server and um Amazon Open source server that's through AVA. So the first, uh, we'll take a look at AVA to FSX for Windows file server and in the deployment architecture what we have is an Amazon FSX server deployed. Now you have three options on how to deploy FSX. You have a multi AZ for HA use cases. You have the single AZ2 and you have the single AZ1 configuration. So at this point, um, AVA only supports the single EZ1 configuration and does not support the other two for various reasons, um, and also you need to deploy an active directory which authenticates the user of when they access FSX. So the flow going from left to right will be the user will deploy uh and launch the connectivity client on the laptop and then. Using the connectivity client, they'll access Ava's um the instance that you define in AA and after authenticating against the trust provider, which in this case is IAM identity center, the user can then connect to the AVA instance, access the defined, um, AVA endpoint, and then through the endpoint they can um access the FSX server. Now every request to that endpoint as as Mike said, is evaluated against the see the policy. So only those um requests that satisfy the policy are allowed access to the end point. So let's take a look at the uh the policy that is going to um control access to this endpoint. So it permits access to the endpoint when the user has an email address that is from Amazon.com and the email address has been verified by IEM Identity Center, which is the uh trust provider that we configured for this use case. So every request is going to be evaluated against that policy, and only those requests that comply with that policy will be allowed access. So the configure AVA, uh, we need some network information from FSX. So first, we need the uh VPC that the FXX server is deployed to, and we also need the network interface of the FSX server. Once we get that, we go to the AVA console. We deploy um or we create a new endpoint and we configure it so that the uh endpoint, um, protocol is set to TCP the uh VPC is set to the VPC of the FSX server. The endpoint type is set the network interface. There is another um endpoint type which uh I'll, I'll talk about a little bit later in the video. Um, I won't talk about it in this session, but I'll give you a reference to the video. And then the port range we set to the SMB port of 445 and um we set the network interface to the network interface of the FSX uh um server. Now for the security group we can set the security group to be the same as the FSX network interface or you can choose a different security group for your AVA endpoint but if you do that you you just need to make sure that the FSX network interface security group allows access from the AVVA endpoint uh security group. Then we hit submit and we create the endpoint and you take the end endpoint domain name to connect to the um Ava endpoint and through that endpoint, you'll connect to FSX. So after that, you will go to the laptop and launch the connectivity client. And through the connectivity client you um authenticate against the configured trust provider, which in this case is IAM identity Center. And after authenticating, You connect to the Eva instances. And then after you connect to the instance and in this case I'll be using Mac OS to demonstrate this, um, you get the AVA endpoint, you connect using the finder, um, using the SMB protocol to the AVA endpoint. And then through the Ava endpoint um you can then connect to FSX FSX will challenge you with Active Directory and after authenticating against the Active Directory, you can then mount the file share into your, uh, finder and, um, you, you'll be able to browse the file share you'll be able to, uh, depending on the permissions that you're, uh, given through Active Directory, you'll be able to drag and drop files into the file share. All right, um, so in the AVA instance, you can't configure access logging and if you enable access logging. Um, Ava will log all access control decisions into cloudwatch logs. So, um, this is an access log entry for the previous interaction. We can see that the authorization decision isn't allowed. We take a look at the user information. We see that the user is named John and John has an email address which is which ends in Amazon.com and it has been verified by the trust provider. So that in this interaction it it um complies with the either policy that we defined for the endpoint. Uh, so this, uh, access was allowed. Uh, now in the privileges field at the bottom that contains the identification or the ID of the Ava endpoint that this authorization decision was made against. Now let's take a look at another user, and this user is named John G. And John G is also defined an IAM identity Center, so he, he launches the connectivity client on the laptop, authenticates against I am identity center, and then is able to access the EVA instance. Now after that John G also would like to access the uh FSX server through the Ava um endpoint. But he experiences a problem, so let's take a look at what might be causing this problem. So we'll take a look at the access log. We see that the authorization decision is a deny and looking at the user information, we see that the user name um is John G uh but. His email address is at gmail.com email address which has not been verified, so this does not comply with the sealer policy that we defined for this endpoint. So John Gi is denied access to the endpoint. So it stops right at the endpoint, does not get the FSX at this point. All right, so let's take a look at um using AVA to uh connect to OpenSearch server list, um, in this case it'll be the OpenSearch serverless private endpoint. And when you configure an OpenSearch serverless private endpoint, OpenSearch will deploy a VPC endpoint that it manages, and it will also deploy a private Route 53 private hosted zone, and in that private hosted zone it will create an entry for the open search endpoint and we'll see how this comes into play like later on, um. I'll show you in the uh and the rest of the present or further on in the presentation what implications this has. So, um, taking a look a look at the flow going from left to right again so it'd be the user will be on the laptop launching the connectivity client to connect to the Ava instance after authenticating against IEM at Danny Center. Then the user will access the AVA endpoint, and through the EVA endpoint, the user will be able to access the VPC endpoint and through the VPC endpoint, the um the user will be able to access open source serverless. So the configure, uh, Ava, we need some uh information from the VPC endpoint, but, um, please, uh, note the endpoint on your bottom right, um, that is the open search endpoint and that is what gets put into the, uh, private hosted zone and that becomes the C name into the VPC, um, endpoint domain name. So taking a look at the VPC endpoint, we get the VPC information so we get the VPC that the VPC endpoint is deployed to and we get the network interface uh that is associated with the VPC endpoint. Then we uh create a Eva endpoint configure it with a TCP set the VPC to the BPC endpoint. Set the endpoint type to network interface and that's the only um endpoint type that uh Ava will support with OpenSearch server list. Um, set the port range to the HTPS port of 443. Set the network interface to the network interface of the BPC endpoint, and then choose your, uh, security group to allow access. Then once we do that we create the um Ava endpoint and again use the endpoint domain to connect to the AVA endpoint. And at this point, um, we will go into the laptop, launch the connectivity client, and then, um, access the AVA instance. Um, this is exactly the same as FSX so it won't show it, but once we connect to the FSX server, we then need an, uh, API client to communicate with uh open source or open search endpoint. And since OpenSearch is, is, uh, protected by IAM, each request needs to be signed through AWS signature before. Um, fortunately, Postman supports this natively through its authorization section. So you just set the authorization type to AWS signature, and then you fill in the uh, the AWS credentials. Um, now, best practice is to use temporary credentials so you can use something like the AWS CLI to generate those credentials, then fill in the credential information. Um, you set the, uh, region to the region that you deploy Ava and OpenSearch, and for the, um, service name, you set that to AOSS, which stands for Amazon OpenSearch serverless. So let's take a look at what this will look like. So we take the endpoint domain name and we put that as the host name within the get within, uh, postman, and this will be a get against the search resource against the OpenSearch. Now notice in the host header, the host header is set to the default host header within um by postman, and that is set to the AVA endpoint. So OpenSearch actually can't resolve this request, so it gives you a 404. And that's because OpenSearch is actually looking for the OpenSearch endpoint and the host's header. So we have to check the default, create a custom host header. And set that to the open search endpoint. And once we do that, then OpenSearch will be able to resolve the request and you'll get back a nice happy green. 200 status. Everyone would be happy at that point. All right, so I went through that relatively quickly. Um, I did create a couple of videos that I, uh, published to the AWS channel on YouTube, and, um, yep, I'll give you time to take a picture. So the first goes over Ava to FSX, um, it goes, it covers the network interface that, uh, I went over today, but it also covers the site of range and point type. And the site of range endpoint type is great when you have a lot of services within that, uh, site of range. So Ava will all discover those IP addresses and it'll make all those services available through the endpoint. So it's a very convenient way to expose a lot of services and protect it and um make sure you have some uh zero trust in place there. And the second takes you step by step, um, to configure Ava to access open search server list. Alright, well thank you very much on behalf of Mike. We thank you for your time. I hope you found this, uh, session valuable and um we'll be available off screen off stage here for questions and have a great rest of the conference.
