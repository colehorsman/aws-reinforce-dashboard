# AWS re:Inforce 2025 - WAF logs to security gold: A 20-minute dashboard revolution (NIS323)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=-1_fCHLoMSk)

## Video Information
- **Author:** AWS Events
- **Duration:** 16.4 minutes
- **Word Count:** 3,104 words
- **Publish Date:** 20250620
- **Video ID:** -1_fCHLoMSk

## Summary

This session demonstrates how to transform AWS WAF logs into actionable security intelligence through CloudWatch dashboards and alarms. The presenter shows how to move beyond basic WAF monitoring to create custom security dashboards that address specific business use cases, such as detecting account creation fraud through CAPTCHA analysis. The solution leverages CloudWatch Logs, CloudWatch Insights, and custom metrics to provide security teams with centralized visibility into web application attacks and automated response capabilities. The approach includes setting up custom dashboards for business-specific metrics, using CloudWatch Log Insights queries in natural language to extract meaningful data, and creating alarms that can trigger notifications or automated remediation actions through Lambda functions.

## Key Points

- **Default vs Custom Dashboards**: AWS WAF provides built-in dashboards with basic metrics, but custom dashboards are needed for business-specific security use cases and threat detection
- **CAPTCHA Fraud Detection**: Demonstrated use case focuses on identifying bot traffic through CAPTCHA abandonment rates versus successful CAPTCHA resolution to detect account creation fraud
- **CloudWatch Log Insights**: Enables natural language queries to extract custom metrics from WAF logs, such as identifying client IPs that successfully resolve CAPTCHAs versus those that abandon them
- **Automated Alerting**: CloudWatch alarms can trigger notifications to security teams and automated remediation actions through Lambda functions when thresholds are exceeded
- **Centralized Security View**: Custom dashboards provide a single pane of glass for security teams to monitor critical metrics, alarm statuses, and threat indicators
- **Cross-Account/Region Support**: CloudWatch supports cross-account and cross-region dashboards for enterprise-wide security monitoring
- **Log Destination Options**: WAF logs can be sent to CloudWatch Logs, Kinesis Data Firehose, or S3 for different analysis approaches
- **Business-Driven Metrics**: Focus on creating metrics that align with specific business threats rather than generic security monitoring

## Technical Details

- **WAF Log Fields**: Utilizes standard WAF log fields including labels, terminating rules, non-terminating rules, URI paths, HTTP methods, client IPs, and user agents
- **Metric Math**: CloudWatch supports mathematical functions on metrics for advanced customization and calculated values
- **Query Generator**: CloudWatch Log Insights includes natural language query generation for creating custom searches without complex syntax
- **Alarm Configuration**: Alarms can be configured with custom thresholds and actions including SNS notifications and Lambda function triggers
- **Widget Types**: Custom dashboards support various widget types including numbers, graphs, and alarm status indicators for visual monitoring
- **CAPTCHA Rules**: Leverages AWS WAF's account creation fraud prevention rules combined with CAPTCHA challenges to differentiate human vs bot traffic
- **Dashboard Integration**: Alarms and custom metrics can be added to dashboards for consolidated security monitoring
- **Composite Alarms**: Advanced feature allowing multiple alarms to be combined for complex alerting scenarios
- **Automated Actions**: Lambda functions can be triggered by alarms to perform automated remediation such as updating IP blocklists or scaling security responses
- **Cross-Service Integration**: Solution integrates WAF logs with CloudWatch metrics, alarms, and dashboards for comprehensive security observability

## Full Transcript

Um, this NIS 323. My name is Isima Emmanuel. I'm a senior solutions architect here at AWS and we'll be talking about what logs and how to be able to create security out of it and basically using dashboards. Um, just to check with the audience, how many of you are familiar with AWSW? Awesome. I think almost everyone. How about Amazon Cloudwatch? OK, we have some people that, that's cool. Um, so basically we're going to try to use our cloudwatch in looking at AWSW, um, just to start, um, when I speak with customers, and this could be some of the reasons why most of you are here. Um, they want to use the WSO, but they want to be able to instrument it, and they want to be able to use it in things like threat detection, being able to understand their security landscape, being able to create custom alerts and custom monitoring. And, uh, really what we are doing, um, during this session is to take all those logs we have within AWSO and then we are going to send it to a destination. And on that destination we're going to try to create dashboards and all that. Um, if you're familiar with W, typically these are some of the log fields you have in WA, uh, things like the labels, the terminating rule, non-termination rule, and all that. And what we're going to do is to send all those data to a destination, specifically we're sending you to cloudwatch logs as what you see there. It's also possible for you to send it to Knees data files and estuary. That do talks about you sending this to estuary and how you can start using Attina and all that in initiating queries. If you were to send this cloud watch that what we are doing in this use case, what you could do is to build a dashboard. Um, within that dashboard, you're going to take all those logs you're getting from AWS that goes to cloudwatch logs. You are going to create the metrics, um, and from those metrics, you are going to create an alarm, all that's sitting within AWS, uh, uh cloudwatch dashboard. Now, so the agenda really, we're going to focus on dashboard, we are going to look at the defaultwa dashboard. We're going to create a custom dashboard and then we are going to create a cloud watch wa alarms, all these focusing on the security aspect of all this. So let's start with the defaultwa dash. But this is something that most of you are already very familiar with. The defaultW dashboard, you have built-in visibility into every web ECL. Um, the time periods are customizable, but really you are using the basic cloud watch metrics that are available. You're not doing any customization on this. Um, I have a demo that walks through the default cloud was dashboard. Um, so if you are familiar with AWS, you are familiar with the Amazon console. If you log directly into the console, you could go directly to your Web ECL which you already created. Within your Web ECL there's typically an associated resource. In this case, you are using a cloud from distribution. Um, you can create your rules. We have your set of rules. Once you have all these created, by default, we are going to give you a dashboard. You don't need to do anything. And if you come to the traffic overview, that is the dashboard we are giving you. Um, there are so many things you can get out of the dashboard. Remember the log field we were initially looked at all those different log fields. We have in the wa log all that is what is expressed in this default dashboard. You can begin to look at things like your URI pads, your HTTP method, your client IPs, your user agents. We can scroll all the way down, you know, as as we can get as many metrics as we can provide you by default. But the limitation with this is most times from a business perspective you may have certain metrics that you want to create to meet your business use case, and this default metrics does not feed into that. You cannot customize this, you can change the time periods, but there's really nothing you can do other than that. And really that is where we'll be taking this session to where we can start looking at how do we create a custom dashboard that fits into your custom metrics. But again, even when creating a custom dashboard, you can take some of the metrics on your default dashboard into your custom dashboard that you create based off your business requirements. So let's take this a little further. Let's Go into the custom dashboard. With the custom dashboard like I mentioned, this is based off your business needs, right? Here some setup is needed. You're still using cloudwat metrics, but the most important thing is now the metrics are customizable. We have something called metric math where you can start playing with Mathematical functions on top of your metrics if you want to customize your metric. Um, we have a demo also on custom metrics, but before I move into that demo, you all have different business use cases. One business use case I was looking at when I was building this was, um, a use case where customers mostly that are retailers and others in other related space where you have somebody that comes in there and keeps creating an account. So somebody comes into your website, keeps creating an account because when every new time they're creating. New accounts, they get some kind of discount, they get some kind of loyalty, they get some kind of gift back. So because of that gift, I create a boat as a malicious user out there and then I keep creating a new account all the time. What that does is that it compromises, you know, your users' experience because they want to take advantage of those loyalty programs and all that. Within AWSW we have a rule which is account creation fraud prevention rule. And that rule basically you could what I think some customers do is use a captcha on top of that rule. So what that means is for every time you are trying to create a new account, you are going to be given a capcha and what that does is that if it is a human, they would be able to solve that capture. If it is a bot, they will not be able to solve the capture, so the capture is going to be abandoned. So that is a common use case. Your use case could be different. So that's the use case we are going to look at in this demo. I'm just going into the demo, just feeding off where we stopped earlier. Um, we are looking at the, the, the same workshop. If we scroll all the way down, we are going to see some metrics on capcha. We are going to see two metrics. We are going to see one metric on capchas that are being solved completely and we are going to see another metric on capcha that are not being resolved. Again, we For us to start creating custom metrics, we are going to go to action totals. You look at the view in cloudwash metrics there. If you right click on it, it's going to take you to a new page where you can take all your metrics. You click on the Xstream there, you create a dash, you mention the dashboard you want to create. You can give the dashboard a name. Um, we can mention a widget type, which is the kind of widget we want to use. And what we are really looking at in this case, we are just trying to understand the landscape of our environment. How many captchas do we have? How many requests are being resolved, how many requests are being abandoned, and we can customize the widget to give it a particular name. And then we click on the create to create our dashboard and then we then add this widget to that dashboard. So that is what we're doing here. We are creating a custom dashboard. Now when we create this custom dashboard, we return back to our business. We are interested in Allowed captures or captures that are being abandoned against captures that are successful. That is what we are focusing on. So we are going to go back to the cloudwatch page. We are going to go back to those particular metrics that we are interested in successful captures, and we are going to put that on our custom dashboard so our security teams will just focus on that. So we do that, we, we, we use the same process we did just now and Then we click on the actions, add it to our dashboard, we give it a particular name. Now this is for captures that are successful, right? We want to use a number which just to have an idea of how many capchas are successful and how many captures are being abandoned. We give it a number we mention a particular name that is user friendly to us and then we drop the capcha there. Now we're going to abandon captures and we are doing the same thing. So we return back to the AWSWF console and then we pick our abandoned capchas and then we, we create the same thing and drop it on that dashboard. Now, this is all great, but as, as, as a security person, we want to also make more sense out of this. We want to see. Um, yes, we have, you know, we, we are seeing our abandoned and our successful captures. Can we determine the client IPs that are making that are being able to get successfully able to answer our captures, which means how many clients IP requests coming from our clients are able to successfully resolve captures. That may be something that is important or we may want to determine how many clients are on. or abandoning captchas that could be a different use case that we are looking at. In our own case, we want to focus on how many clients are basically able to successfully resolve captchas. We have a service called Cloudwatch Log Insights. With Log Insights you'll be able to run login site queries which you can use to determine that. So we are going to go up there. We are going to go to Amazon Cloudwatch. We are going to go to login site queries um. And then that is where we are going to get all that. So we're going on top there, um, going to cloudwatch, um, we click on that tab. You can see login site queries at the bottom there. Within the login site query page, there is something called a query generator. I don't know that you are familiar with this with the query generator, you can enter whats in natural. Language which means in English language, and you'll be able to generate a query and that query you can run against your log. So we are going to do that here we are going to mention on the prompt there we are going to mention that we want to get the number of clients that are successfully resolving a capture. So we're going to enter that and we're going to click on generate new query. Now, in my own case, I, I'm not only interested in in the number of clients, I also want to get a count of those clients. So I'm going to drop in a query that's already generated in there and then run that query. The point, the point here is that you are beginning to create custom metrics by using the login site queries and then you also, you will be able to drop this. On your dashboard. So once we run this query, we get an output there. We are going to click on the add to dashboard icon we have at the end there to add these results back to our already existing created dashboard. So that is what we do there. We bring up our dashboard, we add it to our dashboard, and when we get to our dashboard, we want to give it a very user. name, a name that our security team can easily identify with. So we come there we modify the name and we put a name that makes sense. Now to start getting this all together, we have the number of successful captures. We have captures that are abandoned. We have the clients that are making requests for these captures the accounts. We can go back to our original existing dashboard where we have all the clients IPs that are making requests to our web application. Now we know those that are able to successfully resolve a capture. So if we have an IP address there that is not in this list of IP address that has a very high count, that is potentially beginning to tell us that. That is likely a boat because it's abandoning a capture. So this is, that is basically how you can start beginning to use all these to, you know, you can start instrumenting all this within your environment. You could also say you don't want to focus on captures that are being successfully resolved. You may say you want to focus on captures that are being abandoned. So that is one way, you know, a security team you. And start looking at this. Another thing we also I also wanted to present was cloudwatch alarms, which alarms, even after you have all this data, you may want to start notifying your security team. Apart from notifying your security team, you may also want to trigger custom actions where you could have a lambda function, for instance, take custom actions. So in that use case we also have a demo here where With the demo basically we have our dashboard already created. We are going to go to cloudwatch alarms. We are going to click on our alarms and we are going to go to the metric page. We are going to pick on the wa metrics and here we are focusing on capchas. Remember our use case, our business use cases. We are trying to, uh, you know, identify those captures that are coming from clients. Are they are they being abandoned or are they being successfully resolved? So here we are going. To look at capchas, we are going to look at our specific rule. We are looking at those captures that are being abandoned. We are going to create a threshold where we say if you go beyond this threshold, we want to get this particular notification. It could be triggering a constant a lambda function that goes in and picks those IP addresses and maybe update it on your blog list on AWSW. It all depends on your use case. In my own use case, I'm just making this simple. I'm just sending a notification to a particular team. So you could be. Send a notification to a particular team or you could be using a performing a custom action. Once you create all these, like you can see that there's a lambda action there that is where you could bring in a lambda function to basically perform any custom action that you are interested in. And once you do all that, you can take the alarm that you have created. You could add it into that same custom dashboard you have created. So you create an alarm, you add it into your dashboard. What that provides for your team then is that. Have a central place where they can view all the custom metrics, metrics important to your business and also their alarms. So we see how we create that alarms also on the dashboard. What we can do is that we take our alarm. We want to add it to our dashboard, we click on that to add it to our dashboard. Under the widget type, we are going to say we want to use the widget type of alarm status. What that does is that once this particular threshold is exceeded, that we is going to change from being green to being red, which means if your security team is looking at this at any point in time, they can tell that that is an alarm status. So other than the fact that it is notifying your team on on just by looking at it visibly you can tell that this alarm is in alarm state. So with this, your security team will now have a generous place to view all what is happening within your environment and be able to get notifications out of this. One thing I also get. From customers is they want to be able to have a central place where they can build this cross account cross region. We have cloudwa cross account cross region dashboard um these links tells gives you um access to how to build that with cross account cross region dashboard you could see what is happening across your entire environment whether across your account or across your different regions and send all that that single plane of glass that is a source of truth for your security teams. So by way of summary, um, we, we, the recommendation here is to use the AWS native cloudwa dashboards. You want to use custom dashboards for those business use cases and any non-supported metrics that is important to your business. And lastly, you want to use alarms for notification and remediation. I have an additional resource here. We have cloudwatch composite alarms. Cloudwatch composite alarms is something that you can use where you have multiple alarms. You want to combine them together to perform a particular action. If you want to do settings, you want to do a search on top of your metric. You can use cloudwatch Insights metrics. So that is, these are also resources that you could use when you're setting up um your observability um we're using AWSW. That's all I have for today. Um thank you very much. If you have any questions, be feel free to ask me here.
