# AWS re:Inforce 2025 - Strengthening network security with AWS Network + DNS Firewall (COM321)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=8Si6-hqn_xc)

## Video Information
- **Author:** AWS Events
- **Duration:** 20.6 minutes
- **Word Count:** 2,792 words
- **Publish Date:** 20250620
- **Video ID:** 8Si6-hqn_xc

## Summary
This AWS re:Inforce 2025 session, presented by Kenneth, an E Villiers hero from Malta, focuses on implementing comprehensive network security using AWS Network Firewall and Route 53 DNS Firewall. The presentation covers various network security architectures and implementations across different scenarios, including VPCs, transit gateways, and AWS Cloud One environments.

The session addresses key technical concepts around egress flows, east-west inspection, and DNS security, highlighting the complementary nature of Network Firewall and DNS Firewall in creating a defense-in-depth approach. It explores various deployment scenarios and integration possibilities with different AWS networking components, including recent feature announcements such as active threat defense rules and geo-based filtering.

The presenter emphasizes practical implementation details, including firewall setup procedures, best practices for deployment, and important considerations such as stream exception policies and traffic analysis mode. The session concludes with recommendations for implementing both Network Firewall and DNS Firewall solutions, while being mindful of cost implications and architectural trade-offs.

## Key Points
- Network Firewall and Route 53 DNS Firewall complement each other in a defense-in-depth approach
- Network Firewall can scale up to 100G with 99.99% SLA and supports both stateful and stateless inspection
- New active threat defense rules provide protection against malware, botnets, and crypto mining
- Geo-based filtering allows blocking traffic based on country of origin
- Traffic analysis mode provides 30-day insights into network traffic patterns
- Multi-AZ deployment is crucial for firewall implementation
- DNS Firewall includes advanced protection for DGA and DNS tunneling
- Route 53 profiles enable centralized DNS configuration across multiple VPCs
- Network function groups in Cloud One enable flexible service insertion
- Cost considerations are important, especially for Route 53 resolver implementations

## Technical Details
- Network Firewall deployment requires:
  - Firewall subnet creation
  - Endpoint configuration
  - Multi-AZ implementation
  - Policy binding
  - Monitoring and logging setup
- Network Firewall rule groups include:
  - AWS managed rules (domain and IP)
  - Active threat defense rules
  - Signature rules
  - Custom domain lists
  - Suricata-based rules
- Stream exception policy options:
  - Drop (default)
  - Continue
  - Reset
- DNS Firewall components:
  - Rule groups
  - Custom/managed domain lists
  - VPC associations
  - Advanced protection features
- Integration options:
  - Transit gateway
  - Cloud One
  - Network function groups
  - Service insertion
  - SecurityHub
- Monitoring and logging capabilities:
  - CloudWatch integration
  - Traffic analysis reports
  - TLS inspection
  - Detailed DNS logs and metrics

## Full Transcript

Good morning. Thanks for coming to to see my session. So I'm Kenneth, um, I come from Malta, so it's quite a bit far away. I'm an E Villiers hero and uh my passion is networking and security. So, today, we're going to talk about a number of uh services. So the first one is how we're going to implement egress flows. And also east west inspection with flow those flows. We're going to talk about the network firewall. And also about the Route 53 resolver firewall. And lastly, we're going to have to cover the key takeaways and to summarize what we're going to discuss. So Let's start. So from an introduction perspective, we have a typical setup which is basically uh someI tools talking over to the internet. So what is going to happen? First of all, we are going to have the first DNS query. It goes to the VPC DNS. The second one, the DNS server from Amazon will get the necessary information to start initiating the connection. Gives that information back to. The forwards the traffic to the gateway. From there to the internal gateway, and then the last part is to receive the returned traffic. So, till now, everything OK, just a normal connection without any issues at all. So, no security, you can talk to whatever you want. So, at the NS level, the first thing that we can do is we can implement some protection. So we can use the Route 53 firewall. Secondly, at the network level, we can use also the network firewall. So, you're going to hear these two products, the DNS firewall and the network firewall quite a lot. So, one important point that I see is that They complement each other. I love the way that you can implement protection, both at the DNS level and at the network firewall, and it goes in line with the defense in that approach. So, this is a very basic setup, which both the DNS file and the network file fits well. Let's complicate a bit the network set up. So we're going to start with transit gateways and direct connects. So we have a normal transit gateway. It has VPCs. We have another transit gate to another region, another VPC. Yes, but I want remote connectivity. So we'll start with VPNs. Transit gateway support IPEC, so we can connect through partners to uh remote offices, whatever you want. And also, you can have direct connects, which gives direct connectivity to, to the internal network within the DPPC using a direct connect gateway, and you associate the direct connect gateway with transit gateway. So, this is one scenario. So, where we can apply The security parts. So we can do it at VP level, similar to what we have seen before. We can do it also at the direct connections at the flows from there. And also for the, so we have multiple places where we can put protection. So in this case, we're gonna use the network firewall. So Next setup, cloud one. So a simple cloud one set up with some segments. So we have the direct connect uh gateways. Lately, there was the feature introduced that you can interact directly, direct connect with gateways with uh cloud one. So that was a very good enhancement rather than to have transit gateways. And also, you have DPCs. So, again, When it comes to security, where we can implement security, we can do it at the segment level, we can do it at the direct connect level, and similarly with the VPC level. When it comes to cloud one, there is the network function group and service insertion, and obviously you can use with network firewall. So let's talk a bit now on the network firewall. So what is the network firewall? So, one of the good features of the network file is that can scale up to 100G. So that is quite a lot. And also, it offers an SLA of 99.99. You can use it for ingress egress, filtering east west inspection, and it can be a stateful or a stateless minute service. So you can create rules based on those. You can easily integrate it with Transit gateway and cloud one when it comes to Transit gateway. Yesterday there was a big announcement that you can integrate much more easily network firewall. And also, the network firewall can be managed through the firewall manager. So the firewall manager gives you a complete you, if you want to create baselines and if you have multiple VPCs or multiple implementations, you can enforce those baselines through the firewall manager. And most importantly, uh, it has, you can create alerts, you can create rules, and you can have your own rules or DAWS managed rules. And one of the, I would say a very good feature is that you can integrate uh this uh you can also integrate it with the Securithub. It's cloud native, and we always pay per use, so no upfront commitments. So let's start with the state for rule groups. So, the state to rule groups are divided into, so first, we have the AWS managed rule groups. And then we have the user groups. So when it comes to managed rule groups, you have domain and IP rule groups. You have the newly announced uh uh rule groups which were are the active threat defense rule groups. And also The signature rule groups. For the user lists, for the user groups, you have a domain list that you can do. You can have standard IP based rules and not lastly, you can create the Surikatta rule based. So that gives quite a lot of flexibility when it comes to create rules. So, since this was launched yesterday, I'm just going to mention it briefly. So, a new um mechanism or the active threat defense rules were, were defined. Basically, it includes protection against malware staging URLs, botnet and the command and control server, and crypto mining pools. So, in practice, this is what you're going to see. So you're going to have those two, and if you want to activate them, you just need to select them. Another new feature that was uh that was announced very recently is the geo geo-based hyper filtering. So basically, no network firewall, you can use rules to block certain countries for accessing, blocking, allowing, etc. So this can be applied into Different, uh, so you can match selected countries. You can match all except. You can apply. This can be applied at the source. You can apply it to the destination or both. So it gives you the full functionality that you require normally to operate the geo blocking. And you can also have conjunction with the normal normal stuff which is protocols, source, destination, and IP port matching. So that is quite good. So some unpopular things are not much known. So what is the exception policy? So, faults occur, or there are issues with the network firewall. So some of the cases would be firewall resources exhausted. You can have break-instream sessions for whatever reason. This segments are of sequence. Long-lived connections exceeded firewall time outs. Protocol violations. So what is going to happen? So there are 3 options. So the default is the drop, which means that if some of these conditions happen, The connection is dropped silently without no awareness from the application. So depending on your applications, it could be OK or it could be not OK. The second option is to continue. So just basically ignore that this state happen and it will continue. And the last one is the reset. So, basically similar as the drop, but it will notify the the client and the server using a TCP reset. Again, depending on the applications that you have, you need to fine tune this. What is important is that you monitor it using cloudwatch, and if you're going to see a lot of stream exception policy, you need to check and investigate. Sometimes unfortunately, this is taken for granted, which could lead to application issues. And unfortunately I experienced that, so that's why I I'm mentioning it here. Some new stuff, the traffic analysis mode. So basically, it's very easy to activate. It's just a tick box. But what you would gain is that you have insights of the traffic for the last 30 days. So basically you get the most frequent access domains. The date and time that we first accessed. Number of excess per domain. Last last accessed. Unique IPs and also whether if it was HTTP or HTTPS. And again, that's a simple report that you can get. So this is quite a nice feature to avoid situations where the teams come to you, but we need to protect the egress, but I don't know what traffic is there. So this at least gives you a very good idea to Have what is going on? And there is some reference if you want to scan the QR code, um, there is more information on this new feature. Which it should help quite a lot of people. If you're in the situation where, where you don't know your traffic. OK. All right. So, I don't want the photos left. OK, there's another one. All right, let's continue. So how do we set up the AWS network firewall? So. Step one, You create the firewall, obviously, but you need to do it. Second step You choose DPCs and the subnet for the firewall. Always important, use multi-ACs. If you don't go with 3, at least go with 2. But it's important to deploy always with multi approach. So Activate traffic analysis mode. It's new, it's important to gain insight what's going on, and it can also help to optimize the rules. If you go with the custom rules. You need to create and bind the firewall policy. Next step is to make sure that you have the monitoring and logging. Take care of the stream exception policy. And all remember about the AWS managed rules. These are there. They are from AWS. They see a lot of traffic, and these rules are fine-tuned based on these traffic flows that they see, the bad behaviors, the bad actors, etc. And obviously your own custom firewall rules. So Based on that, you can create the firewalls. Now, the last step. Surikata rules, they can be a bit of a pain to configure, but they give you a lot of visibility. So, tools like from Surikata, you can have like uh. Blocking like old ciphers, that kind of thing. So Qatar are very good to increase the security. And lastly, you have the TLS inspection, so you can intercept the traffic, and you can gain more insights on the TLS. So, how we're going to deploy uh with VPC and transit gateways. So, you have a standard VPC, uh, you have the firewall endpoint that is created. You create a firewall subnet, and then you route the traffic from the private subnet to pass to the firewall endpoints. And from there, it will, the firewall endpoints or the network firewall forward to the net gateway, and then from the net gateway, you go to the IGW. As I said before, it's important that you use the multi approach. And there was a last feature that was released very recently. Now you can associate the same network firewall with multiple multiple VPCs. Transit gateway, similar approach. So you have, you attach the VPC where there is the network firewall, you attach it to the transit gateway, and then you route the traffic accordingly. And there are 2 QR codes if you want to see them. On how to deploy this. OK. Next one. So cloud one, so cloud one. There is a very nice feature, which is, again, the setup is the same, just instead of transit gateway. It's cloud one, but there is an interesting feature, which is the network function groups. So, basically, with the network function groups, you can associate, you attach the, where is the network firewall, the network function group, and then you have service insertion. This is the network function group you created, and then you have The service insertion, you have two options, send via, which means that you're going to have sing segment from 2. And uh then you forward it to the network function group. One thing to notice is there is the single and dual hop, which means that if you can do, if you have multi-region, you can do. I did 11 inspection or 2 inspections. And also, there is the other option, which is the center tube. So, any traffic from a particular segment, just forward it to the net uh to the network uh function group. So, that's for cloud one. So, changing the topic, uh, we have DNS, so DNS can be. Abused. So one of the things which we're going to check now is the. That's the reference for the link. So Quickly. All right, let's continue. So now we're going to talk about the Route 53 is already in this firewall. So, DNS firewall for Route 53 resolvers. It has like network fire manage rules. You have the ability to create denialist or allow list with custom actions. And lately, there was the advanced protection for DG and the DNS tunneling. And you can get decent uh logs and detailed logs and metrics. So, these are the components. You have rule groups, you have rules. You have customers or manage domain list, and you're going to create an action. And you need to associate with uh VPCs. So in order for the DNS4 to be active, you need to associate it with the VPC. So, the advanced feature, so basically there are 22 main uh features. So the first one is, so we have the DNS tunneling and you have the domain generation algorithm. So if someone is abusing, these uh will help mitigate that. Um, in terms of blocking or alerting, my preference is to have medium and uh highest block and low as alert. And the findings can be forwarded to the security apps. So that would be the alerts and that would be the findings for the security app. So, Route 53 profiles, I would say this is, this is the secret source for DNS config. So, quickly, you can centralize the Route 53 configuration across multiple VPCs. You can associate DNS firewall groups. Route troops are the rules, and you can associate private hostage zones. And you can set the default configuration for DNS. Just one thing to note. It can be pricey. Yeah, uh, so there is a base price for 150 PCs. If you extend those 100, the cost can go quite high. So similarly what we did with the network firewall, we're going to do with the DNS firewall. So first we have the domain lists. Secondly, we have the rule groups. Custom domain lists. Rules for managed domains from AWS. Rules for advanced protection. Association of VCs. Share support sharing. And you also associated with the firewall manager, which can control the Route 53 uh resolver DNS firewall. So Transit gateway and DNS firewall, so you implement the routers, the DNS firewall at the VPC level. You integrate it with transit gateway. And then you're going to have. The aggressivePC or the stress inspection connected to the transit gateway and the route to the traffic accordingly. These can be merged, but depends on the functionality that you wish, you can use them that way. I personally prefer them to have them separate. Obviously, it's more costly. So if you need to cater for cost, then one is enough. So cloud one, so same situation. You have the DNS resolvers at the VPC level, and then we have the network function group with service insertion, as we have seen before, attached to the inspection uh VPC. And you can forward the egress VPC traffic for egress there also. So, key takeaways. So, most importantly, I think this is the crucial one, use defense in depth approach. Use both the network firewall and the DNS firewall, integrates findings to security hub. And for the network fire, we enable the traffic analysis mode, monitor the stream exemption policy. And enable the DNS advanced. And if you're a bit worried about the, the implementation starts with the AWS managed rules, even if it's alerting. At least you have something. And most importantly, make sure that there is the process to verify the rules. Thank you.
