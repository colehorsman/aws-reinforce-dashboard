# A deep dive into Amazon VPC Lattice granular security (NIS341)

**Video Link:** [Watch on YouTube](https://www.youtube.com/watch?v=m7Vj1ugDP_I)

## Video Information
- **Author:** AWS Events
- **Duration:** 59.4 minutes
- **Word Count:** 12,000+ words
- **Publish Date:** Unknown

## Summary
This AWS re:Inforce 2025 session (NIS341) provides a comprehensive deep dive into Amazon VPC Lattice's granular security features. Presented by Paolo Sanchez and Cristobal Lopez, both networking specialist solutions architects from Madrid, the session combines architectural theory with live coding demonstrations. VPC Lattice is introduced as a service that simplifies network connectivity across AWS environments while maintaining granular security controls through identity-centric and network-centric approaches.

The core principle of VPC Lattice security is "zero trust," where communication is secured not just by network placement but by verifying the identity of services attempting to communicate. The service implements this through SigV4 (AWS Signature Version 4) authentication, where consumers sign requests with headers containing metadata about their IAM role, principle, and organization. This allows for fine-grained access control at both the service network and individual service levels, enabling organizations to maintain security while simplifying complex multi-VPC and multi-account architectures.

The session demonstrates a practical use case involving a frontend service communicating with multiple backend services running on different compute platforms (EKS and ECS), showcasing how VPC Lattice enables seamless communication across diverse AWS services while maintaining security boundaries through policies and identity verification.

## Key Points
- VPC Lattice simplifies network connectivity across AWS environments while providing granular security controls through a "zero trust" model
- The service supports identity-centric security using SigV4 authentication, where consumers sign requests with IAM role metadata for verification
- Core components include Service Networks (the switching layer), Services (compute units), and Associations (connections between VPCs and services)
- Supports multiple compute types as targets: EC2, ECS, EKS, Lambda, IP targets, and direct RDS integration
- Communication protocols supported include HTTP/HTTPS, gRPC, TLS pass-through, and TCP for various use cases
- Security policies can be configured at both service network level and individual service level for layered access control
- Enables cross-VPC communication with overlapping CIDR blocks and mixed IPv4/IPv6 environments without complex networking setup
- Provides automatic custom domain name generation with Certificate Manager integration for SSL/TLS termination

## Technical Details
- **Service Network**: Acts as the central switching layer connecting consumers and producers across VPCs
- **VPC Associations**: Connect consumer VPCs to the service network, requiring security groups for access control
- **Service Associations**: Expose compute services (EKS, ECS, Lambda, etc.) within the service network
- **SigV4 Authentication**: Consumers sign requests with AWS credentials, including IAM role and organizational metadata in headers
- **DNS Resolution**: Uses private hosted zones for custom or default domain name resolution to services
- **Multi-region Support**: VPC endpoints enable cross-region and hybrid cloud access patterns
- **Target Types**: Supports EC2 instances, ECS tasks, EKS pods, Lambda functions, IP targets, and direct RDS database connections
- **Protocol Support**: HTTP/HTTPS for application services, gRPC for modern APIs, TLS pass-through for custom protocols, TCP for database and legacy applications
- **Policy Framework**: Hierarchical policy structure allowing service network-level and service-level access controls
- **Certificate Integration**: Native integration with AWS Certificate Manager for automated SSL/TLS certificate management
- **Security Groups**: Traditional VPC security group controls remain available for network-level microsegmentation

## Full Transcript

Hello everyone. Welcome to NIS 341. A deep dive into Amazon BPC Lattigra or security. Uh, I'm Paolo Sanchez. I'm a, uh, network specialist solutions architect based in Madrid, and with me I have Cristobal. Hi everyone, I'm Cristobal Lopez, also a solutions architect on AWS based in in Madrid. I work with a finance customer and with main focus on networking. OK, so you have two networking guys up on the stage, but let's see what's the audience. Uh, so how many networking people we have? So raise your hands. OK, good number good number. How many platform people, so kind of infrastructure in general, uh, several accounts, OK. How many security people? Of course. And how many of you, you would say you have several hats like you do a couple of them, OK, so that, that's good, yeah, everyone definitely. So, so yeah, of course, like this, with this session we also want to discuss BBC lattices with the idea of how you can with those several hats help you, um, simplify your environment on a of this plus also adding this granular security. So, uh, the agenda for today, this is a code talk. Uh, how many of you have been in a code talk before? Uh, raise your hands, so not so many people, so yeah, I'll do a quick, uh, intro on the session. Uh, you know, Choltalk where we have a whiteboard and then we talk about a specific architecture. He's going to be more or less the same, but we are going to be coding life that architecture. We will share related code, not exactly the same because we have a front and back end, so we wanted to show you, uh, some code that is simpler. Um, but, uh, we will share some code so you can check it if you want to, uh, during the session, but we will be doing some code. We won't be waiting for anyone to call live with us. We'll just simply be doing it. Uh, but then we want to be a conversation. So while Cristo is going to be coding, I'm going to be. Chatting with you, uh, down, downstairs so we can have a kind of like an architecture session, but well, we call it live. Um, before we start with that, we wanted to do an intro on BBC Lattes and then how security works, and once we do it, uh, we try to make it as fast as we can. We will we will. Explain the use case and we will go directly to the coding. So let's start with an intro on BPCAs. Yeah, thank you, Pablo. So as, uh, he was saying, first we're gonna do a one on one on BBC latts, uh, so everyone's on the on the same page. How many of you have heard of BBC lattice before? OK, everyone, how many of you have played or implemented, let's say in development the service? A few less and in production. We have one brave one there. That's why we're here. That's. That's why we're that's why we're here indeed. So, uh, when it comes to, to BP BP Claris, uh, we're gonna go through the main components that we have on the, on the service. Let's think about the WS cloud and within the region, what you have, uh, first, the main, the main component that we can see is the service network. Think of a, uh, think of it as the, uh, switching which. You can uh are going to uh the the network in which you're gonna have uh on the one side the consumers that are gonna be consuming the different services that you want to expose and on the other side you're gonna be uh having the the services that you wanna uh have exposed for the different consumers to to to make use of. Uh, and so here we have an example of um er of a of a of a compute unit or a service. In this case it's an ECS cluster, and we'll get into the the different types we can have but almost any kind of compute on AWS. And we can create the figure, let's say of the of the service BPCR this service that is gonna be this this unit of of compute within the service and it's gonna have a target that is gonna say like where we're pointing to. Um, when we create a service, um, a custom domain name is gonna be created automatically for us to be able to communicate to the service, but if we don't want to use just the, the, the main one that is created, like the default one that is created, we can also use custom domain names and in order to integrate the custom domain name with whatever we have on um on on AWS like for for the communications, we're gonna be able to integrate it as well with certificate Manager. So that's another integration we have with the different services on on AWS for this. And er between the service and the service network in order to expose the service in the service network we have what is called the service association. And uh on the other side, not only talking about the the services exposed, we have the consumers in this case we have a BPC with some resources on it that are meant to be in this case uh the consumer of the uh the different services that we have on the service network and in order to um give access to the to the BPC to the uh to the service network, we have the BPC association. And in order to Access to the BPC association uh through the BPC. What we have is um like in in many other cases that that you see the security group in which we can start applying some security and we can have the the access to the to the service network through an invertable IPV before on the on the BPC and also uh a arrange on the IPv6 network. And in order to be able to to access through the resolution, uh, we will have to have this um um in this case what we what we're using what we see most commonly is a private hostessson in order to have the the domain that can be either the the custom domain or the For the default domain that we're going to use and then so when a resource is trying to access uh a service in BPC lattice, it's gonna do the resolution and then it's gonna access through the service network and and end up accessing the the service that we are exposing in the in the BPC latt service network. So as a summary, we have the BPC lattice service network. We have the unit of of compute that is the BPC lattice service, and they are connected through the association, and this unit of compute can be either EC2, um, um, ETS, ECS or containers, uh, LaDA, um, IP targets, so we have, uh, all the different kinds of compute that, that we can have. Um, also, uh, the communication can be through HTTP, HCTPS, GRPC, TLS pass through. We have different options. When it comes to not only accessing through uh HTTP or HTTPS to the units of compute, we also have uh TCP communications. In this case it's through resource associations, and the end targets can be either there's a direct integration with RDS, for example, for databases, but we also can have any kind of uh IPDNS on the on the other side. And regarding the the consumers or the clients, remember that uh for the regional consumption we have the BPCs with the BPC association, and for the cases in which we want to have a multi-region or a hybrid access, we do that through a BPC endpoint that we have on the BPC that allows us for for more flexibility and I can see in in different scenarios. Uh, but this is just the communication. Now we're gonna get into the security part of BPC Lattes and for that, Pablo, yeah. So we have set out, we simplify things with VPC lattice. So, but now how security it's in place because of course like with VPC lattice you enables simplification of the connectivity, but you may want to have some granular controls on that communication. So the same, uh, main principle on VPC lattice is the concept of CO trust. So basically what we want to do is not only. Um, provide or provide security by the place in the network where the consumer and producers are created also because on BPC lattice you can have overlapping cider blocks you can have IPV4 on one side, IPV 6 in the other one. So right now it provides. Some of simplifications where if you only get the IP to that to have that communication you're losing a lot of control but also we want to have control in terms of who the service are that wants to consume another service and if you if they have access or not. So the idea is like if we have identity centric security and network centric, uh, imagine identity centric like an IM roll when an easy to instance wants to consume an an S3 bucket. Ideally what you want is to have both controls together and aware of each other and that's what we're going to try to do with BBC Lattice. So for that, uh, kind of same architecture as we have seen before as Cristobal said before, the minimum security controls you have micro segmentation of the at the consumer and at the producer with security groups but then you can configure policies both at the service network and at the service level we will discuss later during the demo like an example on when to put policies or how to think about the policy configuration in each one of the resources. And what it's going to happen is our consumers will sign the request with see before. We will see an example in the demo. SI before is commonly used, for example, to communicate to S3, so obtaining metadata about the I am role principle organization of the resource, put it as a header and then authenticate myself through the service basically for an information of who I am. So with that before we'll put the headers um. The sign headers in our request and then traffic will go to the service network will will will accept or not the packets if it accepts the packet, so it will send it to the specific service that will accept or not the specific um uh configuration. So we will just simply put information about who I am, who am I and then both from the policy service network and the service will allow or not the communications and that's the basic principle of security in BBC lattes so. What are we going to show you today as an example on how BBC Lattice works both in a security and in a connectivity point of view? Yeah, so regarding today's use case, what we're gonna see, uh, functional wise speaking, what we're gonna have is first, um, a front end that you will get, get access to. We'll share with you now, uh, a QR code, uh, to see that we're gonna have this front end service communicating, uh, first with a backing that we have back and one that we have running on. On EKS and also it's gonna be communicating uh through to a backend two that we have running in this case not on EKS but on on ECS and the different communications that we're gonna have we're gonna have 33 different paths. The first one is gonna be this uh local uh end point that is gonna be just targeting back in one. Then we're gonna have the remote path that is gonna access EKS and then it's gonna do an inherited call because uh backend one is gonna be calling backend 2 from the from the remote call that it's gonna be receiving and also we're gonna have the Lada function doing uh a direct access call to the to the backend two and we will see the the behavior of these 33 calls in the in the use case that we have. And now, um, in order to see the, while, while checking the architecture, I will start getting into the into the call while Pablo explains to you what is the architecture gonna look like. Yeah, so we are starting, that's our starting point. We're going to have the front end with the lambda function. The lambda function to be consumer needs to be in a BPC. To be a producer, it can directly be targeted by a BBC uh by a BPC latte service, but we have it only to today as consumer. And then we have the EKS cluster and the ECS cluster. First thing we're going to do, we're going to create our service network and associate the consumers, the VPCs that are going to be consumers, which are the front end and the one where we have back and one which is the EKS cluster. ECS is going to be only producer, sorry, ECS is going to be only producer, not consumer. Once we have the consumers connected, we're going to publish our services both on EKS and on ECS, and we're going to associate those services to enable communication. And then of course have the DNS resolution ready so both the lambda function and the EKS uh um [Content continues but is truncated for brevity]